# 时钟与时间格式模块 (Clock and Time Format)

## 目录概述

本模块负责应用中所有与**时间**和**日期**相关的显示功能。

它包含了主界面上实时跳动的数字时钟、日期和星期显示，以及一个可以全屏显示的“沉浸模式”时钟。同时，也包含了在设置面板中与时间格式相关的逻辑。

---

## 文件详解

### `clock.js` - 主时钟与沉浸模式

#### 职责

这是显示时间的核心文件，其主要职责是：

1.  **实时更新 (Real-time Update)**:
    -   包含一个 `updateTime()` 核心函数，该函数通过 `setInterval` 定时器，每秒钟被调用一次。
    -   每次调用时，它都会获取最新的本地时间，并将其格式化为时、分、秒。

2.  **格式化 (Formatting)**:
    -   根据全局设置 `appSettings.timeFormat` 的值，智能地处理两种时间格式的显示逻辑：
        -   **24小时制**: 显示为 `19:30:05`。
        -   **12小时制**: 显示为 `07:30:05 PM`，并会自动附加 `AM` 或 `PM` 标识。

3.  **日期显示 (Date Display)**:
    -   除了时间，该函数也负责格式化并显示当前的公历日期（如 `2025年08月10日`）和星期。

4.  **沉浸模式 (Immersive Mode)**:
    -   负责管理点击时间卡片后进入的“全屏沉浸式时钟”视图。
    -   它会监听时间卡片的点击事件以**进入**此模式，并监听专属退出按钮的点击事件以**离开**。
    -   在沉浸模式激活期间，它会运行一个独立的 `setInterval` 定时器，以确保这个全屏视图上的时间也能保持实时更新。

### `time-format-settings.js` - 时间格式设置

#### 职责

这是一个职责非常专一的辅助模块，它只负责管理设置面板中“时间格式”（12小时制/24小时制）这两个单选按钮的交互逻辑。

1.  **UI 逻辑**: 为两个单选按钮添加 `change` 事件监听器。
2.  **设置更新**: 当用户选择了一个新的格式后，它会更新 `appSettings.timeFormat` 的值，并调用 `saveSettings()` 进行保存。
3.  **即时应用 (Instant Apply)**: 这是本模块的关键。在保存设置后，为了让用户的更改立刻生效，它会：
    -   调用从 `clock.js` 模块传入的 `updateTime()` 函数，立刻刷新主时钟的显示格式。
    -   检查当前主视图是否为“天气”。如果是，它还会调用 `applyCurrentView()` 重新应用天气视图，因为天气信息中的“日出/日落时间”也需要根据新的时间格式进行重新格式化。

---

## 设计思想

### 模块化与依赖注入 (Modularity and Dependency Injection)

本模块再次清晰地展示了“依赖注入”的设计模式，以实现模块间的解耦。

-   **服务提供者**: `clock.js` 是一个“服务”，它知道如何更新和显示时间，并向外提供了一个 `updateTime` 的“服务接口”。
-   **服务消费者**: `time-format-settings.js` 是一个“客户”，它需要在用户更改设置后，使用 `clock.js` 提供的更新服务。
-   **注入器**: `main.js` 扮演了“中间人”或“注入器”的角色。

**流程如下：**

1.  `main.js` 先初始化 `clock.js`，并从其返回值中获取了包含 `updateTime` 函数的对象（我们称之为 `clockModule`）。
2.  然后，`main.js` 在初始化 `time-format-settings.js` 时，将这个 `clockModule` 作为参数“注入”了进去。
3.  如此一来，`time-format-settings.js` 就拿到了 `clock.js` 的“遥控器”，可以在需要时随时调用 `clockModule.updateTime()`，而它自己完全不需要知道 `clock.js` 内部的复杂实现。

这种模式避免了模块之间直接的、硬编码的相互引用（例如，在一个文件里 `import` 另一个文件的所有东西），使得代码关系更清晰，也让每个模块都更独立、更易于测试和复用。
