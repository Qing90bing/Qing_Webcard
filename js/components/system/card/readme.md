# 卡片管理与轮播模块 (Card Management & Slider)

## 目录概述

本模块负责管理页面右侧区域的、基于“卡片”的交互式布局。

它包含了两个主要部分：
1.  一个**视图管理器**，用于在不同的卡片视图（例如，主视图 vs “关于”卡片）之间进行切换。
2.  一个功能完善的**轮播/滑块**组件，用于展示可左右滑动的链接卡片。

---

## 文件详解

### `card-manager.js` - 卡片视图管理器

#### 职责

这个文件扮演着右侧栏“视图控制器”的角色，它编排和管理着多个卡片视图的显示状态。

1.  **视图切换**:
    -   核心功能是处理主栏（包含多个小卡片）与覆盖型卡片（如“关于”、“时间胶囊”、“节假日列表”）之间的显示和隐藏逻辑。当用户点击触发某个覆盖型卡片时，它会隐藏主栏，显示目标卡片，反之亦然。

2.  **懒加载 (Lazy Loading)**:
    -   为了优化初始加载性能，一些耗时或耗资源的内容被设置为“懒加载”。例如，GitHub的提交历史数据，只在用户第一次点击打开“关于”卡片时，才会去请求API并渲染。

3.  **动画控制**:
    -   在切换视图时，它会负责为新出现的卡片添加 `bounce-in` 的CSS动画类，以实现平滑且富有动感的入场效果。

4.  **全局关闭逻辑**:
    -   它向外提供了一个 `closeOpenCard()` 函数。这个函数被全局的 `escape-handler.js` 模块调用。当用户按下 `Esc` 键时，如果当前有任何一个覆盖型卡片是打开的，这个函数就会负责将其关闭，并恢复显示主栏视图。

### `card-slider.js` - 链接卡片轮播/滑块

#### 职责

这个文件实现了一个高度可重用的、响应式的、功能丰富的轮播组件。

1.  **多种交互方式**:
    -   为了提供最佳的用户体验，它支持几乎所有主流的轮播交互方式：
        -   **鼠标拖动**: 用户可以在PC上按住鼠标左右拖动来切换页面。
        -   **触摸滑动**: 在移动设备上，用户可以通过手指左右滑动来切换。
        -   **鼠标滚轮**: 用户可以将鼠标悬停在轮播区域，通过上下滚动滚轮来左右翻页。
        -   **导航点**: 用户可以直接点击下方的导航点来跳转到指定页面。

2.  **响应式设计**:
    -   它使用了现代的 `ResizeObserver` API来监听轮播器容器的尺寸变化。当浏览器窗口大小改变时，它能自动调整每页应显示的卡片数量（例如，桌面端显示3张，移动端显示2张）以及每张卡片的宽度，确保在任何设备上都有最佳的视觉效果。

3.  **状态管理**:
    -   内部维护了一个详尽的状态对象 (`state`)，用于追踪当前页码、是否正在拖动、轨道的当前位移、拖动速度等信息。这确保了各种复杂的交互（如拖动到一半松手后，根据距离决定是翻页还是弹回）都能被平滑且准确地处理。

---

## 技术实现细节

### 区分拖拽与点击 (Distinguishing Drag from Click)

**问题场景**: 轮播器中的每一张卡片本身都是一个可以点击的链接 (`<a>` 标签)，但它们也需要能被鼠标拖动。一个经典的用户体验问题是：当用户在卡片上完成一次“拖动”操作后，浏览器常常也会把这个动作的结束识别为一次 `click` 事件，从而导致页面意外跳转到卡片的链接地址。

**解决方案**: `card-slider.js` 使用了一个简单的布尔标志位 `hasDragged` 来解决这个问题。

1.  当 `mousedown` (或 `touchstart`) 事件发生时，`hasDragged` 被重置为 `false`。
2.  在 `mousemove` (或 `touchmove`) 过程中，如果鼠标/手指的移动距离超过了一个很小的阈值（例如10像素），脚本就判定用户的意图是“拖动”，并将 `hasDragged` 设为 `true`。
3.  在每张卡片上都绑定了一个 `click` 事件监听器。这个监听器在执行时会检查 `hasDragged` 标志。如果标志为 `true`，它就会调用 `event.preventDefault()`，这个方法会阻止 `<a>` 标签的默认导航行为。
4.  这样，只有当用户是“原地”按下并快速松开（即没有发生有效拖动）时，链接才会正常跳转，完美地分离了用户的两种操作意图。

### 响应式观察器 (ResizeObserver)

为了实现响应式布局，传统的做法是监听 `window.onresize` 事件。但这个事件在用户拖动窗口边缘时会**非常频繁**地触发，可能导致不必要的重复计算，影响性能。

`card-slider.js` 采用了更现代、更高效的 `ResizeObserver` API。
-   这个观察器可以直接附加到轮播器的容器元素上。
-   它的回调函数**只会在**该容器的尺寸确实发生变化时才被触发，不多不少，恰到好处。
-   这使得组件的响应式逻辑更精确，性能也更好，是现代Web开发中创建响应式组件的首选方案。
