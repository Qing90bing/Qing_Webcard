# 主视图管理器 (Main View Manager)

## 目录概述

本模块的用途是控制应用主内容区域（即左侧最大的卡片区域）应该显示哪个“主视图”。

目前，它专门负责管理**“GitHub 贡献图”视图**和**“天气信息”视图**之间的切换逻辑。

---

## 文件详解

### `view-manager.js` - 视图切换与设置逻辑

#### 职责

这个文件处理了与两大主视图相关的所有管理逻辑。

1.  **视图应用 (View Application)**:
    -   模块的核心是 `applyCurrentView` 函数。它会读取全局设置 `appSettings.view` 的值。
    -   根据这个值，它会隐藏其中一个视图的容器（`#github-view` 或 `#weather-view`），并显示另一个。
    -   **关键点**: 在显示某个视图后，它会立刻调用该视图对应的内容加载函数（例如，调用 `setupGitHubChartLoader()` 或 `fetchAndDisplayWeather()`）。这确保了用户每次看到的都是最新的内容。

2.  **设置UI管理 (Settings UI Management)**:
    -   负责管理“设置”面板中，允许用户选择首选主视图的三个单选按钮的逻辑。这包括处理“GitHub”、“天气 - 自动定位”和“天气 - 手动输入”这三个选项之间的互斥关系。

3.  **条件UI (Conditional UI)**:
    -   它根据用户的选择，动态地控制“手动输入城市”输入框的显示和隐藏。只有当用户明确选择了“天气 - 手动输入”时，这个输入框才会滑出。

4.  **输入处理 (Input Handling)**:
    -   包含了当用户在“手动输入城市”框中输入内容并保存时的所有逻辑，包括对输入内容的合法性验证（例如，长度不能超过20个字符）以及保存成功后的动画反馈。

---

## 设计思想

### 视图与数据加载的绑定

理解本模块的一个关键点是，它并**不仅仅是**切换两个 `<div>` 的可见性。

`applyCurrentView` 函数的设计确保了**视图的显示与其内容的加载/刷新是紧密绑定的**。当一个视图被切换为可见时，其内容获取逻辑也会被立即触发。
-   切换到天气视图 -> 立刻获取最新天气。
-   切换回GitHub视图 -> 立刻重新初始化贡献图的加载器。

这种模式可以有效地防止用户看到“陈旧”或“过时”的数据，保证了信息的新鲜度。

### 复合设置状态 (Composite Settings State)

这个功能的设置界面是处理“复合状态”的一个好例子。界面上的三个单选按钮，并不能一对一地映射到 `appSettings` 里的某一个单独的属性上。

用户的选择，实际上是由**两个**设置属性共同决定的：
1.  `appSettings.view`: `'github'` 还是 `'weather'`？
2.  `appSettings.weather.source`: `'auto'` 还是 `'manual'`？

`updateViewToggleUI` 函数就演示了如何从这个复合的数据状态，派生出正确的UI显示状态。例如，只有当 `view` 是 `'weather'` **并且** `source` 是 `'manual'` 时，`"天气 - 手动输入"` 这个单选按钮才应该被选中。

在开发更复杂的应用时，这种一个UI状态由多个数据状态组合而成的情况非常常见。这个模块提供了一个清晰的、可供参考的实现范例。
