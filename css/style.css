/* --- CSS Variables and Theming --- */
        :root {
            /* [NEW] Appearance variables */
            --card-border-radius: 16px;
            --card-backdrop-blur: 16px;
        }
        body.theme-dark {
            --immersive-bg-color: #111827;
            --solid-card-bg-color: #1e293b; /* slate-800 */
            --icon-hover-bg: rgba(255, 255, 255, 0.1);
            --bg-color: #0d1a26;
            --card-bg-color: rgba(30, 41, 59, 0.75);
            --card-border-color: rgba(255, 255, 255, 0.1);
            --card-hover-bg-color: rgba(30, 41, 59, 0.80);
            --card-hover-border-color: rgba(255, 255, 255, 0.2);
            --text-color-primary: #e5e7eb; /* gray-200 */
            --text-color-secondary: #9ca3af; /* gray-400 */
            --text-color-tertiary: #6b7280; /* gray-500 */
            --accent-color: #38bdf8; /* sky-400 */
            --selection-bg-color: rgba(56, 189, 248, 0.7);
            --accent-color-highlight: rgba(56, 189, 248, 0.15);
            --progress-bar-bg: rgba(255, 255, 255, 0.1);
            --link-color: #e5e7eb;
            --link-hover-color: #fff;
            --separator-color: rgba(255, 255, 255, 0.1);
            --status-past: #6b7280; /* gray-500 */
            --status-yesterday: #eab308; /* yellow-500 */
            --status-today: #22c55e; /* green-500 */
            --status-tomorrow: #60a5fa; /* blue-400 */
        }
        body.theme-light {
            --immersive-bg-color: #f9fafb;
            --solid-card-bg-color: #f1f5f9; /* slate-100 */
            --icon-hover-bg: rgba(0, 0, 0, 0.08);
            --bg-color: #0d1a26; /* slate-100 */
            --card-bg-color: rgba(255, 255, 255, 0.75);
            --card-border-color: rgba(0, 0, 0, 0.08);
            --card-hover-bg-color: rgba(255, 255, 255, 0.80);
            --card-hover-border-color: rgba(0, 0, 0, 0.12);
            --text-color-primary: #1e293b; /* slate-800 */
            --text-color-secondary: #475569; /* slate-600 */
            --text-color-tertiary: #64748b; /* slate-500 */
            --accent-color: #3b82f6; /* blue-500 */
            --selection-bg-color: rgba(59, 130, 246, 0.7);
            --accent-color-highlight: rgba(59, 130, 246, 0.1);
            --progress-bar-bg: rgba(0, 0, 0, 0.08);
            --link-color: #1e293b;
            --link-hover-color: #000;
            --separator-color: rgba(0, 0, 0, 0.1);
            --status-past: #64748b; /* slate-500 */
            --status-yesterday: #ca8a04; /* yellow-600 */
            --status-today: #16a34a; /* green-600 */
            --status-tomorrow: #2563eb; /* blue-600 */
        }

        /* 自定义样式 */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; /* 防止出现双滚动条 */
        }
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color-primary);
            transition: color 0.3s ease, background-color 0.3s ease;
        }

        /* --- [NEW] Accessible Focus Styles --- */
        /* Replace the default browser outline with a custom, theme-aware one. */
        /* :focus-visible is a modern pseudo-class that applies focus styles only when appropriate (e.g., keyboard navigation). */
        *:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px var(--accent-color);
        }

        /* --- [NEW] Custom Selection Styles --- */
        ::selection {
            background-color: var(--selection-bg-color);
            color: white;
        }

        /* --- [NEW] JS-Powered Tooltip Style --- */
        .js-tooltip {
            position: fixed;
            background-color: var(--accent-color);
            color: white;
            padding: 8px 12px;
            border-radius: 7px;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            max-width: 220px;
            word-wrap: break-word;
            z-index: 9999; /* Ensure it's on top of everything */
            pointer-events: none; /* Let clicks pass through */
            opacity: 0;
            transform: scale(0.95) translateY(5px);
            transition: opacity 0.15s ease-out, transform 0.15s ease-out;
        }

        /* 背景图片容器 */
        #bg-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
        }
        .bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .bg-layer.active {
            opacity: 1;
        }

        .glass-card {
            background-color: var(--card-bg-color);
            backdrop-filter: blur(var(--card-backdrop-blur));
            -webkit-backdrop-filter: blur(var(--card-backdrop-blur));
            border-radius: var(--card-border-radius);
            border: 1px solid var(--card-border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.2s ease, backdrop-filter 0.3s ease, border-radius 0.3s ease;
        }
        
        .glass-card:hover {
            background-color: var(--card-hover-bg-color);
            border: 1px solid var(--card-hover-border-color);
        }

        /* --- [NEW] Solid Card Style for Disabled Glass Effect --- */
        body.glass-effect-disabled .glass-card {
            background-color: var(--solid-card-bg-color);
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }
        
        body.glass-effect-disabled .glass-card:hover {
            background-color: var(--solid-card-bg-color);
            border-color: var(--card-hover-border-color);
        }

        body.glass-effect-disabled #settings-window.glass-card:hover,
        body.glass-effect-disabled #developer-settings-window.glass-card:hover {
            background-color: var(--solid-card-bg-color);
            border: 1px solid var(--card-border-color);
        }

        .icon-btn:hover {
            background-color: var(--accent-color-highlight);
            transition: all 0.3s ease;
        }

        /* Override for settings window to disable hover effect */
        #settings-window.glass-card:hover,
        #developer-settings-window.glass-card:hover {
            background-color: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
        }

        #time-display, .runtime-number, #countdown-display, #holiday-list-container, #time-capsule-card {
            font-variant-numeric: tabular-nums;
        }
        
        #time-display {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            text-shadow: 0 0 10px var(--accent-color);
        }

        .simplebar-scrollbar:before {
            background-color: var(--accent-color);
            border-radius: 4px;
        }
        .simplebar-track.simplebar-vertical {
            width: 8px;
        }

        /* [FIXED] Q弹动画 - 移除了opacity属性以修复背景透明问题 */
        @keyframes bounce-in {
            0% { transform: scale(0.95); }
            60% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        .bounce-in {
            animation: bounce-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* [REVISED] Logo Click Animation */
        @keyframes logo-click-bounce {
            0% {
                transform: scale3d(1, 1, 1);
            }
            50% {
                transform: scale3d(0.8, 0.8, 1);
            }
            100% {
                transform: scale3d(1, 1, 1);
            }
        }
        .logo-click-bounce-anim {
            transform-origin: center;
            animation: logo-click-bounce 0.3s ease-out;
        }

        /* 进度条样式 */
        .progress-bar {
            background-color: var(--progress-bar-bg);
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar-inner {
            background-color: var(--accent-color);
            border-radius: 9999px;
            transition: width 0.5s ease-out;
        }
        
        /* 高亮最近的节日 */
        .highlight-holiday {
            background-color: var(--accent-color-highlight);
            border-left: 3px solid var(--accent-color);
        }

        #holiday-list-container {
            transition: opacity 0.1s ease-in-out;
        }
        #holiday-list-year {
            transition: opacity 0.1s ease-in-out, color 0.2s ease-in-out;
        }
        #holiday-list-year:hover {
            color: var(--accent-color);
        }

        #holiday-list-container-wrapper {
            --fade-top-size: 40px;
            --fade-bottom-size: 40px;
            -webkit-mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
            mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
        }

        /* [FIX] Suppress the browser's default focus outline on the scrollable area */
        #settings-window [data-simplebar]:focus {
            outline: none;
        }

        #settings-window [data-simplebar] {
            --fade-top-size: 24px;
            --fade-bottom-size: 24px;
            -webkit-mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
            mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
        }

        #back-to-today-btn {
            display: flex;
            border: 1px solid var(--card-border-color);
            background-color: var(--accent-color);
            opacity: 0;
            transform: scale(0.9);
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out, visibility 0s linear 0.2s, background-color 0.2s ease;
        }
        #back-to-today-btn:hover {
            opacity: 0.85 !important;
        }
        #back-to-today-btn.visible {
            opacity: 0.7;
            transform: scale(1);
            visibility: visible;
            pointer-events: auto;
            transition-delay: 0s;
        }

        #main-wrapper {
            height: 100vh;
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out, opacity 0.2s ease-in-out;
        }
        
        /* --- Settings Modal States --- */
        #settings-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out, visibility 0s linear 0.2s;
        }
        #settings-window {
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.15s ease-in-out;
            height: 680px; /* [FIX] Set a fixed height for consistency */
            max-height: 85vh; /* Add a responsive max-height for smaller viewports */
        }

        body.settings-open #main-wrapper {
            opacity: 0;
            pointer-events: none;
        }
        body.settings-open #bg-wrapper {
            transform: scale(1);
            filter: blur(16px);
        }
        body.settings-open #settings-overlay {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }
        body.settings-open #settings-window {
            transform: scale(1);
            opacity: 1;
        }

        #developer-icon-container {
            height: 0;
            opacity: 0;
            overflow: hidden;
            margin-top: 0;
            transition: height 0.3s ease-out, opacity 0.3s ease-out, margin-top 0.3s ease-out;
        }
        #developer-icon-container.visible {
            height: 2rem; /* h-8 */
            opacity: 1;
            margin-top: 0.5rem; /* mt-2 */
        }

        /* [FIX] Developer icon color should be theme-dependent. */
        #developer-icon {
            color: var(--text-color-secondary);
            transition: color 0.2s ease-in-out;
        }
        #developer-icon:hover {
            color: var(--text-color-primary);
        }
        body.new-year-active #developer-icon {
            color: var(--accent-color);
        }
        body.new-year-active #developer-icon:hover {
            /* In NY theme, primary text is a light cream color, providing a nice hover effect */
            color: var(--text-color-primary); 
        }

        /* --- [NEW] Developer Settings Modal States --- */
        #developer-settings-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out, visibility 0s linear 0.2s;
        }
        #developer-settings-window {
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.15s ease-in-out;
            height: 680px;
            max-height: 85vh;
        }
        body.developer-settings-open #main-wrapper {
            opacity: 0;
            pointer-events: none;
        }
        body.developer-settings-open #bg-wrapper {
            transform: scale(1);
            filter: blur(16px);
        }
        body.developer-settings-open #developer-settings-overlay {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }
        body.developer-settings-open #developer-settings-window {
            transform: scale(1);
            opacity: 1;
        }

        /* --- [NEW] Reset Confirmation Modal States --- */
        body.reset-confirm-open #settings-window {
            /* Keep the settings window visible but slightly blurred/scaled back */
            filter: blur(4px);
            transform: scale(0.98);
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
        }
        body.reset-confirm-open #reset-confirm-overlay {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }
        #reset-confirm-window {
            /* This is the modal panel itself */
            transform: scale(0.95);
            opacity: 0;
            height: 220px; /* [FIX] Set fixed height */
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* [FIX] Combine transitions to include hover effects from .glass-card */
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.15s ease-in-out;
        }

        #reset-confirm-state, #reset-success-state {
            transition: opacity 0.2s ease-in-out;
        }
        body.reset-confirm-open #reset-confirm-window {
            transform: scale(1);
            opacity: 1;
        }
        /* Remove the bounce-in animation from the base class if it was applied, as we use transitions now */
        #reset-confirm-window.bounce-in {
            animation: none;
        }


    /* --- [NEW] Immersive Time View --- */
    #immersive-time-view {
        position: fixed;
        inset: 0;
        z-index: 100; /* Higher than settings overlay */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: var(--immersive-bg-color);
        color: var(--text-color-primary);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, background-color 0.3s ease;
    }

    #exit-immersive-btn {
        position: absolute;
        top: 2rem;  /* 32px */
        right: 2rem; /* 32px */
        width: 3rem;  /* 48px */
        height: 3rem; /* 48px */
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 9999px;
        color: var(--text-color-secondary);
        background-color: transparent;
        cursor: pointer;
        border: none; /* remove default button border */
        opacity: 0;
        visibility: hidden;
        /* Combine transitions for a cleaner rule */
        transition: color 0.2s ease-in-out, background-color 0.2s ease-in-out, transform 0.2s ease-in-out, opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
    }
    #exit-immersive-btn.visible {
        opacity: 1;
        visibility: visible;
        transition-delay: 0s;
    }
    #exit-immersive-btn:hover {
        color: var(--text-color-primary);
        background-color: var(--accent-color-highlight);
    }
    #exit-immersive-btn:active {
        transform: scale(0.95);
    }
    #exit-immersive-btn svg {
        width: 1.75rem; /* 28px */
        height: 1.75rem; /* 28px */
    }
    
    #immersive-date-display {
        font-size: 1.5rem; /* text-2xl */
        line-height: 2rem;
        color: var(--text-color-secondary);
        transition: color 0.3s ease;
    }
    #immersive-time-display {
        font-size: 4.5rem; /* text-7xl for mobile */
        line-height: 1;
        font-weight: 700;
        margin-top: 1rem;
        margin-bottom: 1rem;
        font-variant-numeric: tabular-nums;
        font-family: 'Inter', sans-serif;
        text-shadow: 0 0 20px var(--accent-color);
        transition: color 0.3s ease, text-shadow 0.3s ease;
    }
    @media (min-width: 1024px) {
        #immersive-time-display {
            font-size: 8rem; /* text-9xl for desktop */
        }
    }
    #immersive-greeting {
        font-size: 1.25rem; /* text-xl */
        line-height: 1.75rem;
        color: var(--text-color-secondary);
        transition: color 0.3s ease;
    }
    
    /* State when immersive view is active */
    body.immersive-active #main-wrapper {
        opacity: 0;
        filter: blur(4px);
        transform: scale(0.98);
        pointer-events: none;
        transition: opacity 0.3s ease-in-out, filter 0.3s ease-in-out, transform 0.3s ease-in-out;
    }
    body.immersive-active #immersive-time-view {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }

    /* --- [NEW] New Year Theme --- */
    /* [REVISED] Dark Mode New Year Theme */
    body.new-year-active.theme-dark {
        --card-bg-color: rgba(80, 20, 20, 0.65); /* Deep maroon */
        --card-border-color: rgba(220, 38, 38, 0.3); /* Crimson border */
        --card-hover-bg-color: rgba(80, 20, 20, 0.75);
        --card-hover-border-color: rgba(220, 38, 38, 0.5);
        --text-color-primary: #fff7e6; /* Creamy white */
        --text-color-secondary: #ffdab9; /* Peach puff for secondary text */
        --text-color-tertiary: #e53e3e; /* A slightly softer red for tertiary */
        --accent-color: #dc2626; /* Ruby red */
        --accent-color-highlight: rgba(220, 38, 38, 0.25);
    }

    /* [REVISED] Light Mode New Year Theme */
    body.new-year-active.theme-light {
        --card-bg-color: rgba(255, 247, 247, 0.8); /* Very light, almost creamy red tint */
        --card-border-color: rgba(190, 30, 30, 0.25);
        --card-hover-bg-color: rgba(255, 247, 247, 0.9);
        --card-hover-border-color: rgba(190, 30, 30, 0.4);
        --text-color-primary: #9b2c2c; /* Deep maroon text */
        --text-color-secondary: #c53030; /* Strong red for secondary */
        --text-color-tertiary: #e53e3e;
        --accent-color: #c53030; /* Main crimson accent */
        --accent-color-highlight: rgba(197, 48, 48, 0.1);
    }

    /* [FIX] Toggle Switch Styles for New Year Theme */
    body.new-year-active .toggle-slider {
        background-color: rgba(120, 50, 50, 0.5); /* Muted maroon for 'off' state */
    }

    body.new-year-active input:checked + .toggle-slider {
        background-color: var(--accent-color); /* Use the theme's accent color for 'on' state */
    }
    
    /* --- [REVISED] Vinyl Music Player Styles --- */
    #new-year-music-btn {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
        /* [MODIFIED] Add opacity, visibility and transform for smooth transition */
        opacity: 0;
        visibility: hidden;
        transform: scale(0.9);
        transition: opacity 0.3s ease, visibility 0s linear 0.3s, transform 0.3s ease;
        /* position: fixed 由 Tailwind 的 'fixed' class 提供，它同样能为子元素创建定位上下文。 */
    }
    #new-year-music-btn.visible {
        opacity: 1;
        visibility: visible;
        transform: scale(1);
        transition-delay: 0s;
    }
    #new-year-music-btn:hover {
        transform: scale(1.1);
    }
    #new-year-music-btn:active {
         transform: scale(1.05);
         transition-duration: 0.1s;
    }

    .music-player-vinyl {
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: #111;
        background-image: repeating-radial-gradient(circle at center, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.05) 1px, transparent 1px, transparent 2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        /* [FIX] 直接应用动画，并将其初始状态设置为暂停 */
        animation: spin 4s linear infinite;
        animation-play-state: paused;
    }
    
    /* Vinyl Highlight Effect */
    .music-player-vinyl::after {
        content: '';
        position: absolute;
        top: -10%;
        left: -10%;
        width: 120%;
        height: 120%;
        background: radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0) 50%);
        transform: rotate(-30deg);
        pointer-events: none;
    }

    /* [FIX] 使用 animation-play-state 来控制旋转，而不是添加/移除整个动画 */
    #new-year-music-btn.is-playing .music-player-vinyl {
        animation-play-state: running;
    }

    .album-art {
        width: 60%; /* Resized */
        height: 60%; /* Resized */
        border-radius: 50%;
        object-fit: cover;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    .vinyl-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem; /* 20px, 进一步缩小图标以获得更精致的外观 */
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        pointer-events: none; /* Let clicks pass through to the button */
    }

    #new-year-music-btn:hover .vinyl-overlay,
    #new-year-music-btn.is-paused .vinyl-overlay {
        opacity: 1;
    }
    
    /* Icon Styles & Transition */
    .vinyl-overlay .icon-play,
    .vinyl-overlay .icon-pause {
        position: absolute;
        opacity: 0;
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        transform: scale(0.8);
    }

    #new-year-music-btn.is-paused .icon-play {
        opacity: 1;
        transform: scale(1);
    }

    #new-year-music-btn.is-playing .icon-pause {
        opacity: 1;
        transform: scale(1);
    }

    @media (max-width: 1023px) {
        html, body {
            height: auto;
            overflow-y: auto;
        }
        #main-wrapper {
            height: auto;
        }
        #holiday-list-card {
            height: 70vh;
        }
    }

    /* Animations for Year Input */
    @keyframes fade-in-anim {
        from { opacity: 0; transform: scale(0.98); }
        to { opacity: 1; transform: scale(1); }
    }

    @keyframes fade-out-anim {
        from { opacity: 1; transform: scale(1); }
        to { opacity: 0; transform: scale(0.98); }
    }

    .animate-fade-in {
        animation: fade-in-anim 0.1s ease-out forwards;
    }

    .animate-fade-out {
        animation: fade-out-anim 0.1s ease-in forwards;
    }
    
    /* Shake animation for error feedback */
    @keyframes shake-anim {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-3px); }
      40%, 60% { transform: translateX(3px); }
    }

    #year-input.invalid {
        border-color: #ef4444 !important; /* red-500, a consistent error color */
        animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }

    #luck-button {
        background-color: var(--accent-color);
        opacity: 0.9;
        transition: transform 0.15s ease-out, opacity 0.2s ease-in-out, background-color 0.2s ease-in-out;
    }
    #luck-button:hover {
        opacity: 1;
    }

    /* --- [NEW] New Year Theme UI Consistency --- */
    /* Ensure settings highlights and buttons match the theme's accent color. */
    body.new-year-active #luck-button {
        background-color: var(--accent-color);
    }

    body.new-year-active .setting-radio-input:checked + .setting-radio-label {
        background-color: var(--accent-color-highlight);
        border-color: var(--accent-color);
    }

    body.new-year-active .setting-radio-input:checked + .setting-radio-label .custom-radio-button {
        border-color: var(--accent-color);
    }

    body.new-year-active .setting-radio-input:checked + .setting-radio-label .custom-radio-button::after {
        background-color: var(--accent-color);
    }

    body.new-year-active .hitokoto-checkbox-input:checked + .hitokoto-checkbox-label .custom-checkbox {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
    }

    #luck-result {
        transition: max-width 0.5s ease-in-out, opacity 0.3s ease-in-out, margin-left 0.5s ease-in-out, padding 0.5s ease-in-out;
        max-width: 0;
        opacity: 0;
        padding-left: 0;
        padding-right: 0;
        margin-left: 0;
    }
    #luck-result.visible {
        max-width: 500px; /* A large enough value to not clip content */
        opacity: 1;
        padding-left: 1rem;
        padding-right: 1rem;
    }

    /* --- [NEW] Luck Game Animations --- */
    .luck-shake {
        animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    @keyframes luck-pop {
        0% { transform: scale(1); }
        50% { transform: scale(1.3); }
        100% { transform: scale(1); }
    }
    .luck-pop-anim {
        animation: luck-pop 0.2s ease-in-out;
    }
    @keyframes fade-out-opacity-only-anim {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    .fade-out-opacity-only {
        animation: fade-out-opacity-only-anim 0.3s ease-out forwards;
    }

    /* --- [NEW] Blinking Colon Animation --- */
    @keyframes instant-blink {
        /* This creates a 50/50 blink effect */
        50% { opacity: 0; }
    }
    body.immersive-blink-enabled #immersive-time-view .time-colon {
        animation: instant-blink 1s steps(1, end) infinite;
        position: relative;
        top: -0.05em; /* Prevents vertical layout shift */
    }

    /* GitHub Chart Placeholder Styles */
    #gh-chart-container {
        position: relative;
    }
    #gh-chart-spinner {
        position: absolute;
        top: 0.75rem; /* 12px */
        right: 0.75rem; /* 12px */
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 10;
        transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        opacity: 0;
        visibility: hidden;
    }
    #gh-chart-spinner.visible {
        opacity: 1;
        visibility: visible;
    }
    #gh-chart-wrapper {
        aspect-ratio: 892 / 140;
        border-radius: 0.375rem; /* 6px */
        overflow: hidden;
    }


    #gh-chart-img.loaded {
        opacity: 1;
    }

    #gh-chart-link.visible {
        visibility: visible;
    }

    #gh-chart-error {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
    }
    #gh-chart-error.visible {
        opacity: 1;
        visibility: visible;
        transition-delay: 0s;
    }

    /* --- [NEW] Preview Loader and Animations --- */
    #preview-loader {
        position: absolute;
        top: 0.75rem; /* 12px */
        right: 0.75rem; /* 12px */
        width: 24px;
        height: 24px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 10;
        transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        opacity: 0;
        visibility: hidden;
    }
    #preview-loader.visible {
        opacity: 1;
        visibility: visible;
    }

    #bg-preview-error {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s, background-color 0.2s ease-in-out, backdrop-filter 0.2s ease-in-out;
    }
    #bg-preview-error p:first-child {
        color: var(--accent-color);
    }
    #bg-preview-error p:last-child {
        color: var(--text-color-primary);
    }
    #bg-preview-error:hover {
        background-color: rgba(0,0,0,0.45);
        backdrop-filter: blur(8px);
    }
    #bg-preview-error.visible {
        opacity: 1;
        visibility: visible;
        transition-delay: 0s;
    }

    /* --- [NEW] Weather Loader --- */
    #weather-content-wrapper {
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: min-height 0.3s ease-in-out;
    }
    .weather-icon-initial {
        opacity: 0;
    }
    .weather-icon-loaded {
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
    }
    #weather-loader {
        position: absolute;
        top: 0.75rem; /* 12px */
        right: 0.75rem; /* 12px */
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 10;
        transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        opacity: 0;
        visibility: hidden;
    }
    #weather-loader.visible {
        opacity: 1;
        visibility: visible;
    }
    #weather-data-container {
        transition: opacity 0.3s ease-in-out;
    }

    .weather-hover-zone:hover + #weather-refresh-btn,
    #weather-refresh-btn:hover {
        opacity: 1;
        visibility: visible;
        transition-delay: 0s;
    }
    #weather-refresh-btn {
        transition: opacity 0.2s ease-in-out, color 0.2s ease-in-out, background-color 0.2s ease-in-out, visibility 0s linear 0.2s;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes breathing {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    .breathing-effect {
        animation: breathing 2s ease-in-out infinite;
    }
    
    /* Utility to hide elements cleanly */
    .hidden {
      display: none !important;
    }

    /* [NEW] Custom class for commit messages to ensure they wrap correctly */
    .commit-message-text {
        word-break: break-all;
    }

    .themed-hover-bg:hover {
        background-color: var(--accent-color-highlight);
    }

    /* [NEW] Custom Native Scrollbar for Commit List */
    #recent-commits-container::-webkit-scrollbar {
        width: 8px;
    }
    #recent-commits-container::-webkit-scrollbar-track {
        background: transparent;
    }
    #recent-commits-container::-webkit-scrollbar-thumb {
        background-color: var(--accent-color);
        border-radius: 4px;
        border: 2px solid transparent;
        background-clip: content-box;
    }
    #recent-commits-container::-webkit-scrollbar-thumb:hover {
        background-color: var(--accent-color-highlight);
    }

    /* --- [NEW] Timeline Styles for Commit History --- */
    .timeline-item {
        display: flex;
        position: relative;
    }
    .timeline-item:not(:last-child) .timeline-node::after {
        content: '';
        position: absolute;
        top: 1.25rem; /* Start below the dot */
        left: 50%;
        transform: translateX(-50%);
        width: 2px;
        height: 100%;
        background-color: var(--separator-color);
    }
    .timeline-node {
        position: relative;
        flex-shrink: 0;
        width: 2rem; /* 32px */
        display: flex;
        justify-content: center;
        padding-top: 0.25rem; /* Align dot with text */
    }
    .timeline-node::before {
        content: '';
        position: absolute;
        top: 0.5rem; /* Vertically center the dot */
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--accent-color);
        border: 2px solid var(--card-bg-color);
        z-index: 1;
    }
    .timeline-content {
        flex-grow: 1;
        padding-bottom: 1rem; /* space between date groups */
    }
    .timeline-item:last-child .timeline-content {
        padding-bottom: 0;
        padding-top: 2px; /* Nudge down for alignment */
    }

    /* --- [NEW] Commit Avatar Styles --- */
    .commit-avatar {
        box-shadow: 0 0 0 1px var(--separator-color);
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    .commit-avatar.loaded {
        opacity: 1;
    }

    /* --- [NEW] Commit History Loading State --- */
    #recent-commits-container {
        transition: opacity 0.3s ease-in-out;
        --fade-top-size: 0px; /* Default to 0, enabled by JS */
        --fade-bottom-size: 0px; /* Default to 0, enabled by JS */
        -webkit-mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
        mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
    }

    .commit-loader-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 27rem; /* Match parent's max-height to fill the space */
    }

    .commit-spinner {
        width: 28px;
        height: 28px;
        border: 3px solid var(--separator-color);
        border-top-color: #fff; /* Use white for the highlight */
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
    }

    /* --- [NEW] Commit Refresh Button Styles --- */
    #refresh-commits-btn {
        opacity: 0;
        visibility: hidden;
        transform: scale(0.95);
        transition: opacity 0.2s, visibility 0.2s, transform 0.2s, background-color 0.2s;
    }
    #refresh-commits-btn:hover:not(:disabled) {
        background-color: var(--accent-color-highlight);
    }
    #commit-history-panel:hover #refresh-commits-btn:not(:disabled) {
        opacity: 1;
        visibility: visible;
        transform: scale(1);
    }
    #refresh-commits-btn.is-refreshing {
        opacity: 1;
        visibility: visible;
        transform: scale(1);
    }
    #refresh-commits-btn:active:not(:disabled) {
        transform: scale(0.9);
    }
    #refresh-commits-btn:disabled {
        cursor: not-allowed;
    }

    /* --- Settings UI Styles --- */
    #background-preview-container {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
    }
    body.settings-open #background-preview-container.visible {
        max-height: 400px;
        opacity: 1;
        margin-top: 0.75rem;
    }
    #bg-preview-wrapper {
        border: 1px solid var(--card-border-color);
    }

    #bg-preview-wrapper.visible {
        max-height: 200px;
        opacity: 1;
    }
    #bg-preview-img {
        transition: opacity 0.3s ease-in-out;
        background-color: var(--progress-bar-bg); /* [FIX] Add placeholder background */
    }

    #bg-preview-download-btn.visible {
        transform: scale(1);
    }

    #bg-preview-download-btn:hover {
        transform: scale(1.1);
    }

    #bg-preview-refresh-btn.visible {
        transform: scale(1);
    }

    #bg-preview-refresh-btn:hover {
        transform: scale(1.1);
    }

    #bg-preview-download-btn:active,
    #bg-preview-refresh-btn:active {
        transform: scale(1);
        transition: transform 0.1s;
    }

    .setting-section {
        border-top: 1px solid var(--separator-color);
        padding-top: 1.5rem;
    }
    .setting-section:first-child {
        border-top: none;
        padding-top: 0;
    }
    .setting-radio-label {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease-in-out;
        border: 1px solid transparent;
    }
    .setting-radio-label:hover {
        background-color: var(--accent-color-highlight);
    }
    .setting-radio-input {
        display: none; /* Hide original radio button */
    }
    .setting-radio-input:checked + .setting-radio-label {
        background-color: var(--accent-color-highlight);
        border-color: var(--accent-color);
    }
    .custom-radio-button {
        width: 1.25em;
        height: 1.25em;
        border: 2px solid #9ca3af; /* gray-400 */
        border-radius: 50%;
        /* margin-right is replaced by parent gap */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: border-color 0.2s;
        flex-shrink: 0;
    }
    .setting-radio-input:checked + .setting-radio-label .custom-radio-button {
        border-color: var(--accent-color);
    }
    .custom-radio-button::after {
        content: '';
        width: 0.75em;
        height: 0.75em;
        background-color: var(--accent-color);
        border-radius: 50%;
        transform: scale(0);
        transition: transform 0.15s ease-in-out;
    }
    .setting-radio-input:checked + .setting-radio-label .custom-radio-button::after {
        transform: scale(1);
    }
    .setting-description {
        font-size: 0.8rem;
        color: var(--text-color-secondary);
        line-height: 1.3;
        transition: color 0.2s ease-in-out;
    }
    .setting-radio-input:checked + .setting-radio-label .setting-description {
        color: var(--text-color-primary);
    }
    .setting-description.text-center {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }

    #default-bg-options {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out, padding-top 0.3s ease;
        opacity: 0;
        padding-left: 0.5rem; /* Symmetrical padding */
        padding-right: 0.5rem; /* Symmetrical padding */
    }
    #default-bg-options.open {
        max-height: 300px; /* Adjust as needed */
        opacity: 1;
        padding-top: 0.75rem;
        padding-bottom: 0.5rem; /* Add space for hover effect */
    }
    .thumb-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.75rem;
        justify-content: center;
    }
    .thumb-item {
        aspect-ratio: 16 / 9;
        border-radius: 0.5rem; /* Softer corners */
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s, transform 0.2s;
        position: relative;
        background-color: rgba(255, 255, 255, 0.05);
    }
    .thumb-item:hover {
        transform: scale(1.05);
    }
    .thumb-item:active {
        transform: scale(0.98);
    }
    .thumb-item.active {
        border-color: var(--accent-color);
    }
    .thumb-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .thumb-item .thumb-overlay {
        position: absolute;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.875rem;
    }

    .theme-swatch {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        cursor: pointer;
        padding: 4px;
        border: 2px solid transparent;
        transition: border-color 0.2s, transform 0.2s;
    }
    .theme-swatch:hover {
        transform: scale(1.1);
    }
    .theme-swatch.active {
        border-color: var(--accent-color);
        transform: scale(1.1);
    }
    .swatch-color {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    body.theme-light .swatch-color {
        border-color: rgba(0, 0, 0, 0.2);
    }

    .setting-btn-group {
        display: flex;
        border-radius: 0.8rem;
        background-color: var(--progress-bar-bg);
    }
    .theme-slider {
        background-color: var(--accent-color);
        border-radius: 0.8rem; /* Match parent container */
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        /* The magic bounce transition */
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .setting-btn {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 0.5rem;
        background-color: transparent;
        color: var(--text-color-secondary);
        border: none;
        cursor: pointer;
        transition: color 0.2s ease-in-out;
        font-size: 0.875rem;
        font-weight: 500; /* Make all text slightly bolder */
    }
    /* No border needed for the new design */
    .setting-btn:not(:last-child) {
       border-right: none;
    }
    .setting-btn.active {
        color: white;
    }
    .setting-btn:hover:not(.active) {
        color: var(--text-color-primary);
    }

    .progress-bar-text {
        color: var(--text-color-primary);
        text-shadow: 0 0 4px rgba(0,0,0,0.5);
    }
    body.theme-light .progress-bar-text {
        /* In light mode, the primary text is dark, so a light shadow is better for contrast against the accent-colored bar */
        text-shadow: 0 0 4px rgba(255,255,255,0.5);
    }
    
    /* --- Toggle Switch --- */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 52px;
        height: 28px;
    }
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--text-color-tertiary);
        transition: all .3s;
        border-radius: 28px;
    }

    .toggle-switch:hover .toggle-slider {
        box-shadow: 0 0 0 4px var(--accent-color-highlight);
    }
    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-radius: 50%;
    }
    input:checked + .toggle-slider {
        background-color: var(--accent-color);
    }
    input:focus + .toggle-slider {
        box-shadow: 0 0 1px var(--accent-color);
    }
    input:checked + .toggle-slider:before {
        transform: translateX(24px);
    }

/* --- [NEW] Slider Styles --- */
.setting-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    background: var(--progress-bar-bg);
    background-image: linear-gradient(var(--accent-color), var(--accent-color));
    background-size: 0% 100%;
    background-repeat: no-repeat;
    border-radius: 5px;
    outline: none;
    transition: opacity .2s, background-size 0.1s linear;
    --slider-progress: 0%;
}
.setting-slider:hover {
    opacity: 1;
}
.setting-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 22px;
    height: 22px;
    background: #fff;
    cursor: pointer;
    border-radius: 50%;
    border: 2px solid var(--accent-color);
    box-shadow: 0 1px 3px rgba(0,0,0,0.4);
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.2s ease;
}
.setting-slider::-moz-range-thumb {
    width: 22px;
    height: 22px;
    background: #fff;
    cursor: pointer;
    border-radius: 50%;
    border: 2px solid var(--accent-color);
    box-shadow: 0 1px 3px rgba(0,0,0,0.4);
}
.setting-slider:hover::-webkit-slider-thumb {
    transform: scale(1.1);
}
.setting-slider:active::-webkit-slider-thumb {
    transform: scale(1.2);
    background-color: var(--accent-color);
}
.setting-slider:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
.setting-slider:disabled::-webkit-slider-thumb {
    background-color: var(--text-color-tertiary);
    border-color: var(--text-color-tertiary);
    transform: scale(1);
}

    /* --- [NEW] Manual City Input Styles --- */
    #weather-city-input {
        transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        appearance: none;
        -webkit-appearance: none; /* Removes inner shadow on iOS */
        padding-right: 2.5rem; /* Make space for the icon */
    }
    #weather-city-input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px var(--accent-color-highlight);
    }
    #weather-city-input.invalid {
        border-color: #ef4444 !important; /* red-500 */
        animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    #save-city-btn, #confirm-city-icon {
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out, color 0.2s ease-in-out;
    }
    #city-input-error {
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        transform: translateY(-4px);
        opacity: 0;
    }
    #city-input-error.visible {
        transform: translateY(0);
        opacity: 1;
    }

    #custom-bg-input.invalid {
        border-color: #ef4444 !important;
        animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    #custom-bg-input-error {
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        transform: translateY(-4px);
        opacity: 0;
    }
    #custom-bg-input-error.visible {
        transform: translateY(0);
        opacity: 1;
    }

    #custom-bg-input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px var(--accent-color-highlight);
    }
    #custom-bg-input {
        transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }
    #custom-bg-input::placeholder {
        transition: color 0.3s ease-in-out;
        color: var(--text-color-tertiary);
    }
    #custom-bg-input.invalid::placeholder {
        color: #ef4444; /* red-500 */
    }

    /* --- [NEW] Hitokoto Settings Styles --- */
    #hitokoto-custom-options {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out, padding-top 0.3s ease, margin-top 0.3s ease;
        opacity: 0;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }
    #hitokoto-custom-options.open {
        max-height: 500px; /* Adjust as needed */
        opacity: 1;
        padding-top: 0.75rem;
        margin-top: 0.5rem;
    }
    .hitokoto-checkbox-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 0.75rem;
    }
    .hitokoto-checkbox-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        padding: 0.3rem 0.5rem;
        border-radius: 0.375rem;
        transition: background-color 0.2s ease-in-out;
    }
    .hitokoto-checkbox-label:hover {
        background-color: var(--accent-color-highlight);
    }
    .hitokoto-checkbox-label.invalid {
        animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    #hitokoto-validation-msg {
        color: #ef4444; /* red-500 */
        font-weight: 500;
        font-size: 0.875rem;
        opacity: 0; /* Initially hidden */
    }
    #hitokoto-validation-msg.visible {
        animation: fade-in-out 3s ease-in-out forwards;
    }
    @keyframes fade-in-out {
        0% { opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { opacity: 0; }
    }
    .custom-checkbox {
        width: 1.15em;
        height: 1.15em;
        border: 2px solid #9ca3af;
        border-radius: 0.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: border-color 0.2s, background-color 0.2s;
    }
    .custom-checkbox svg {
        width: 0.8em;
        height: 0.8em;
        color: white;
        transform: scale(0);
        transition: transform 0.15s ease-in-out;
    }
    .hitokoto-checkbox-input:checked + .hitokoto-checkbox-label .custom-checkbox {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
    }
    .hitokoto-checkbox-input:checked + .hitokoto-checkbox-label .custom-checkbox svg {
        transform: scale(1);
    }
    #hitokoto-save-btn {
        color: var(--text-color-secondary);
        transition: color 0.2s, transform 0.2s;
        font-weight: 500;
    }
    #hitokoto-save-btn:hover {
        color: var(--text-color-primary);
    }
    #hitokoto-save-btn:active {
        transform: scale(0.97);
    }

    /* --- Particle Animation Styles --- */
    #luck-container {
        position: relative; /* Ensure the container is a positioning context for particles */
    }
    #particle-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        /* overflow: hidden; */ /* FIX: Removed to allow particles to fly out */
        /* z-index: 10; */ /* FIX: Removed to ensure particles are behind text/buttons */
    }
    .particle {
        position: absolute;
        left: 0;
        top: 0;
        transform: translate(-50%, -50%); 
        pointer-events: none;
        will-change: transform, opacity;
    }
    .particle.circle {
        border-radius: 50%;
    }
    .particle.square {
        border-radius: 0;
    }
    .particle.triangle {
        background-color: transparent !important;
    }
    .particle.star {
        clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        background-color: var(--star-color);
    }
    .particle.heart {
        position: relative;
        transform: rotate(-45deg) translate(-50%, -50%);
        background-color: transparent;
    }
    .particle.heart::before,
    .particle.heart::after {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: inherit;
    }
    .particle.heart::before {
        top: -50%;
        left: 0;
    }
    .particle.heart::after {
        top: 0;
        left: 50%;
    }

    /* --- [NEW] Link Card Slider Styles --- */
    #link-slider-container {
        position: relative;
        padding-bottom: 0rem; /* Make space for the absolute positioned dots */
        margin: 0 -0.5rem;
    }
    .slider-wrapper {
        overflow: hidden;
        cursor: grab;
        padding: 0.5rem;
    }
    .slider-wrapper.grabbing {
        cursor: grabbing;
    }
    .slider-track {
        display: flex;
        gap: 1rem; /* Corresponds to the old `gap-4` */
        /* `transition` will be controlled by JS for snapping */
    }
    .card-slide {
        flex-shrink: 0;
        width: calc((100% - 2 * 1rem) / 3); /* Default for 3 cards, gap-4 is 1rem */
        transition: transform 0.2s ease-in-out;
        position: relative;
    }
    .card-slide:hover {
        z-index: 10;
    }

    .slider-dots {
        position: absolute;
        bottom: -0.6rem;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 0.5rem; /* 8px */
    }
    .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .dot:hover {
        background-color: rgba(255, 255, 255, 0.6);
    }
    .dot.active {
        background-color: rgba(255, 255, 255, 1);
    }
    body.theme-light .dot {
        background-color: rgba(0, 0, 0, 0.3);
    }
    body.theme-light .dot:hover {
        background-color: rgba(0, 0, 0, 0.6);
    }
    body.theme-light .dot.active {
        background-color: rgba(0, 0, 0, 1);
    }

    /* --- [NEW] Appearance Settings Disabled State --- */
    #blur-setting-content-wrapper {
        transition: filter 0.3s ease-in-out;
    }
    #blur-setting-container.disabled #blur-setting-content-wrapper {
        filter: blur(4px);
        pointer-events: none;
    }
    #blur-slider-overlay {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
        pointer-events: none; /* Prevent interaction when hidden */
    }

    /* Responsive fix for theme buttons on small screens */
    @media (max-width: 420px) {
        .setting-btn {
            padding-left: 0.4rem;
            padding-right: 0.4rem;
            font-size: 0.8rem;
        }
        .setting-btn > i {
            margin-right: 0.25rem;
        }
    }
    body.settings-open #blur-setting-container.disabled #blur-slider-overlay {
        opacity: 1;
        visibility: visible;
        pointer-events: auto; /* Allow interaction when visible */
        transition-delay: 0s;
    }

    /* --- [NEW] Background Settings Disabled State --- */
    #main-background-settings-wrapper.disabled #main-background-settings-content {
        filter: blur(4px);
        pointer-events: none;
    }
    #background-settings-overlay {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
        pointer-events: none; /* Prevent interaction when hidden */
    }
    body.settings-open #main-background-settings-wrapper.disabled #background-settings-overlay {
        opacity: 1;
        visibility: visible;
        pointer-events: auto; /* Allow interaction when visible */
        transition-delay: 0s;
    }

    /* Full-screen modals on mobile */
    @media (max-width: 1023px) {
        #settings-overlay, #developer-settings-overlay {
            padding: 0;
        }

        #settings-window, #developer-settings-window {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            border-radius: 0;
        }
    }
