/*
 * @file: settings.css
 * @description: 定义设置面板内部的特定布局和组件样式。
 */

/* --- 设置窗口内的滚动区域 --- */
/**
 * @id #settings-window
 * @description 为设置窗口内的 SimpleBar 滚动容器添加顶部和底部的渐变遮罩，
 *              以在内容滚动时产生平滑的淡出效果。
 */
#settings-window [data-simplebar] {
    /* 顶部和底部的渐变遮罩，以产生内容淡出效果 */
    --fade-top-size: 24px;
    --fade-bottom-size: 24px;
    -webkit-mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
    mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
}

/* --- 背景预览 --- */
/**
 * @id #background-preview-container
 * @description 背景图片预览区域的容器。
 * @property {max-height}, {opacity}, {overflow} - 默认状态下折叠并隐藏，通过添加 .visible 类来展开。
 */
#background-preview-container {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    /* [改进] 过渡效果将在 body.settings-open 下方定义，以避免不必要的动画 */
}
/**
 * @selector body.settings-open #background-preview-container.visible
 * @description 仅在设置面板打开时应用过渡效果，这样可以避免在页面初始加载时，
 *              如果预览容器默认可见，会触发不必要的进入动画。
 */
body.settings-open #background-preview-container.visible {
    transition: max-height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out, margin-top 0.3s ease;
    max-height: 400px;
    opacity: 1;
    margin-top: 0.75rem;
}
/**
 * @id #bg-preview-wrapper
 * @description 预览图片的外层包装器，提供边框。
 */
#bg-preview-wrapper {
    border: 1px solid var(--card-border-color);
}
/**
 * @id #bg-preview-img
 * @description 预览图片元素本身。
 * @property {background-color} - 使用占位背景色，在图片加载完成前提供视觉反馈，改善用户体验。
 */
#bg-preview-img {
    transition: opacity 0.3s ease-in-out;
    /* 使用 --progress-bar-bg 作为图片加载前的占位背景色，改善加载体验 */
    background-color: var(--progress-bar-bg); /* [修复] 添加占位背景色，改善加载体验 */
}
/**
 * @id #preview-loader
 * @description 在加载预览图片时显示的旋转加载指示器。
 */
#preview-loader {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    width: 24px;
    height: 24px;
    border: 3px solid rgba(255, 255, 255, 0.2);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 10;
    transition: opacity 0.3s ease, visibility 0s linear 0.3s;
    opacity: 0;
    visibility: hidden;
}
#preview-loader.visible {
    opacity: 1;
    visibility: visible;
}
/**
 * @id #bg-preview-error
 * @description 在预览图片加载失败时显示的错误信息覆盖层。
 */
#bg-preview-error {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s, background-color 0.2s ease-in-out, backdrop-filter 0.2s ease-in-out;
}
#bg-preview-error p:first-child {
    /* 错误提示中的图标颜色使用主题强调色 */
    color: var(--accent-color);
}
#bg-preview-error p:last-child {
    color: var(--text-color-primary);
}
/**
 * @selector #bg-preview-error:hover
 * @description 鼠标悬停在错误信息上时，应用背景和模糊效果，使其更易于阅读。
 */
#bg-preview-error:hover {
    background-color: rgba(0,0,0,0.45);
    backdrop-filter: blur(8px);
}
#bg-preview-error.visible {
    opacity: 1;
    visibility: visible;
    transition-delay: 0s;
}

/* --- 设置项分区 --- */
/**
 * @class .setting-section
 * @description 设置面板中的每个设置区域块。
 * @property {border-top} - 使用 `--separator-color` 作为分区之间的分割线。
 */
.setting-section {
    border-top: 1px solid var(--separator-color);
    padding-top: 1.5rem;
}
.setting-section:first-child {
    border-top: none;
    padding-top: 0;
}
.setting-description {
    font-size: 0.8rem;
    color: var(--text-color-secondary);
    line-height: 1.3;
    transition: color 0.2s ease-in-out;
}
/* 当单选按钮被选中时，其对应的描述文本颜色变亮，以提供更强的视觉反馈 */
.setting-radio-input:checked + .setting-radio-label .setting-description {
    color: var(--text-color-primary); /* 选中项的描述文本颜色更亮 */
}
.setting-description.text-center {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
}


/* --- 默认背景图选项 --- */
/**
 * @id #default-bg-options
 * @description 包含预设背景图缩略图的可折叠区域。
 * @property {transition} - 为 max-height, opacity 等属性添加过渡，实现平滑的展开和折叠动画。
 */
#default-bg-options {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out, padding-top 0.3s ease;
    opacity: 0;
    padding-left: 0.5rem;
    padding-right: 0.5rem;
}
/**
 * @class .open
 * @description 当此区域需要展开时，由JS添加此类。
 */
#default-bg-options.open {
    max-height: 300px; /* 展开时的高度 */
    opacity: 1;
    padding-top: 0.75rem;
    padding-bottom: 0.5rem; /* 为悬停放大效果留出空间 */
}
/**
 * @class .thumb-container
 * @description 缩略图的网格容器。
 * @property {grid-template-columns} - 使用 `repeat(auto-fill, minmax())` 创建一个响应式的、自动填充的网格布局。
 */
.thumb-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); /* 响应式网格布局 */
    gap: 0.75rem;
    justify-content: center;
}
/**
 * @class .thumb-item
 * @description 背景图的缩略图项。
 * @property {border-color} - 选中的缩略图边框颜色由 `--accent-color` 控制。
 */
.thumb-item {
    aspect-ratio: 16 / 9;
    border-radius: 0.5rem;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s, transform 0.2s;
    position: relative;
    background-color: rgba(255, 255, 255, 0.05); /* 缩略图加载前的占位背景 */
}
.thumb-item:hover {
    transform: scale(1.05);
}
.thumb-item:active {
    transform: scale(0.98);
}
.thumb-item.active {
    border-color: var(--accent-color); /* 选中项的边框 */
}
.thumb-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.thumb-item .thumb-overlay {
    position: absolute;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.875rem;
}


/* --- 主题颜色选择器 --- */
/**
 * @class .theme-swatch
 * @description 主题颜色选择器中的圆形颜色样本。
 * @property {border-color} - 激活的颜色样本边框由 `--accent-color` 控制。
 */
.theme-swatch {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    cursor: pointer;
    padding: 4px;
    border: 2px solid transparent;
    transition: border-color 0.2s, transform 0.2s;
}
.theme-swatch:hover {
    transform: scale(1.1);
}
.theme-swatch.active {
    border-color: var(--accent-color);
    transform: scale(1.1);
}
.swatch-color {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.2);
}


/* --- 设置按钮组 (带滑块效果) --- */
/**
 * @class .setting-btn-group
 * @description 一个带有滑动背景的按钮组，用于切换设置选项。
 * @property {background-color} - 按钮组的轨道背景色由 `--progress-bar-bg` 控制。
 */
.setting-btn-group {
    display: flex;
    border-radius: 0.8rem;
    background-color: var(--progress-bar-bg);
}
/**
 * @class .theme-slider
 * @description 按钮组中滑动的背景元素。
 * @property {background-color} - 滑块的颜色由 `--accent-color` 控制。
 */
.theme-slider {
    background-color: var(--accent-color);
    border-radius: 0.8rem; /* 匹配父容器 */
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    /* 带回弹效果的过渡动画 */
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.setting-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem 0.5rem;
    background-color: transparent;
    color: var(--text-color-secondary);
    border: none;
    cursor: pointer;
    transition: color 0.2s ease-in-out;
    font-size: 0.875rem;
    font-weight: 500;
}
.setting-btn.active {
    color: white; /* 激活状态的按钮文本颜色 */
}
.setting-btn:hover:not(.active) {
    color: var(--text-color-primary);
}
/* 小屏幕下的响应式调整 */
@media (max-width: 420px) {
    .setting-btn {
        padding-left: 0.4rem;
        padding-right: 0.4rem;
        font-size: 0.8rem;
    }
    .setting-btn > i {
        margin-right: 0.25rem;
    }
}


/* --- 一言自定义选项 --- */
/**
 * @id #hitokoto-custom-options
 * @description “一言”自定义类别选项的可折叠区域，其行为与 #default-bg-options 类似。
 */
#hitokoto-custom-options {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out, padding-top 0.3s ease, margin-top 0.3s ease;
    opacity: 0;
    padding-left: 0.5rem;
    padding-right: 0.5rem;
}
/**
 * @class .open
 * @description 当此区域需要展开时，由JS添加此类。
 */
#hitokoto-custom-options.open {
    max-height: 500px;
    opacity: 1;
    padding-top: 0.75rem;
    margin-top: 0.5rem;
}
/**
 * @class .hitokoto-checkbox-container
 * @description “一言”类别复选框的响应式网格容器。
 */
.hitokoto-checkbox-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.75rem;
}


/* --- 设置项禁用状态 --- */
/**
 * @selector #blur-setting-container.disabled ..., #main-background-settings-wrapper.disabled ...
 * @description 当某个设置项被禁用时（例如，当“毛玻璃效果”关闭时，其下方的模糊度滑块应被禁用），
 *              通过 `filter: blur(4px)` 和 `pointer-events: none` 为其内容创造出一种“不可用”的视觉效果。
 */
#blur-setting-container.disabled #blur-setting-content-wrapper,
#main-background-settings-wrapper.disabled #main-background-settings-content {
    filter: blur(4px);
    pointer-events: none; /* 禁止交互 */
}
/**
 * @id #blur-slider-overlay, #background-settings-overlay
 * @description 在被禁用的设置项上显示的半透明遮罩层，通常用于承载提示信息（如“该选项已禁用”）。
 *              默认隐藏。
 */
#blur-slider-overlay,
#background-settings-overlay {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
    pointer-events: none;
}
/**
 * @selector body.settings-open #blur-setting-container.disabled ..., body.settings-open #main-background-settings-wrapper.disabled ...
 * @description 当设置面板打开且某个设置项被禁用时，显示对应的遮罩层。
 */
body.settings-open #blur-setting-container.disabled #blur-slider-overlay,
body.settings-open #main-background-settings-wrapper.disabled #background-settings-overlay {
    opacity: 1;
    visibility: visible;
    pointer-events: auto; /* 允许交互（例如显示提示） */
    transition-delay: 0s;
}
