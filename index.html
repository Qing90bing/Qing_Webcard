<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qing90bingçš„ä¸»é¡µ</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.css" />
    <script src="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- CSS Variables and Theming --- */
        body.theme-dark {
            --bg-color: #0d1a26;
            --card-bg-color: rgba(30, 41, 59, 0.7);
            --card-border-color: rgba(255, 255, 255, 0.1);
            --card-hover-bg-color: rgba(30, 41, 59, 0.75);
            --card-hover-border-color: rgba(255, 255, 255, 0.2);
            --text-color-primary: #e5e7eb; /* gray-200 */
            --text-color-secondary: #9ca3af; /* gray-400 */
            --text-color-tertiary: #6b7280; /* gray-500 */
            --accent-color: #38bdf8; /* sky-400 */
            --accent-color-highlight: rgba(56, 189, 248, 0.15);
            --progress-bar-bg: rgba(255, 255, 255, 0.1);
            --link-color: #e5e7eb;
            --link-hover-color: #fff;
            --separator-color: rgba(255, 255, 255, 0.1);
            --status-past: #6b7280; /* gray-500 */
            --status-yesterday: #eab308; /* yellow-500 */
            --status-today: #22c55e; /* green-500 */
            --status-tomorrow: #60a5fa; /* blue-400 */
        }
        body.theme-light {
            --bg-color: #f1f5f9; /* slate-100 */
            --card-bg-color: rgba(255, 255, 255, 0.7);
            --card-border-color: rgba(0, 0, 0, 0.08);
            --card-hover-bg-color: rgba(255, 255, 255, 0.75);
            --card-hover-border-color: rgba(0, 0, 0, 0.12);
            --text-color-primary: #1e293b; /* slate-800 */
            --text-color-secondary: #475569; /* slate-600 */
            --text-color-tertiary: #64748b; /* slate-500 */
            --accent-color: #3b82f6; /* blue-500 */
            --accent-color-highlight: rgba(59, 130, 246, 0.1);
            --progress-bar-bg: rgba(0, 0, 0, 0.08);
            --link-color: #1e293b;
            --link-hover-color: #000;
            --separator-color: rgba(0, 0, 0, 0.1);
            --status-past: #64748b; /* slate-500 */
            --status-yesterday: #ca8a04; /* yellow-600 */
            --status-today: #16a34a; /* green-600 */
            --status-tomorrow: #2563eb; /* blue-600 */
        }

        /* è‡ªå®šä¹‰æ ·å¼ */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; /* é˜²æ­¢å‡ºç°åŒæ»šåŠ¨æ¡ */
        }
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color-primary);
            transition: background-color 0.1s ease, color 0.1s ease;
        }

        /* èƒŒæ™¯å›¾ç‰‡å®¹å™¨ */
        #bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .glass-card {
            background: var(--card-bg-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 1rem;
            border: 1px solid var(--card-border-color);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: var(--card-hover-bg-color);
            border: 1px solid var(--card-hover-border-color);
        }

        /* Override for settings window to disable hover effect */
        #settings-window.glass-card:hover {
            background: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
        }

        #time-display, .runtime-number, #countdown-display, #holiday-list-container, #time-capsule-card {
            font-variant-numeric: tabular-nums;
        }
        
        #time-display {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            text-shadow: 0 0 10px var(--accent-color);
        }

        .simplebar-scrollbar:before {
            background-color: var(--accent-color);
            opacity: 0.6;
            border-radius: 4px;
        }
        .simplebar-track.simplebar-vertical {
            width: 8px;
        }

        /* [FIXED] Qå¼¹åŠ¨ç”» - ç§»é™¤äº†opacityå±æ€§ä»¥ä¿®å¤èƒŒæ™¯é€æ˜é—®é¢˜ */
        @keyframes bounce-in {
            0% { transform: scale(0.95); }
            60% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        .bounce-in {
            animation: bounce-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            background-color: var(--progress-bar-bg);
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar-inner {
            background-color: var(--accent-color);
            border-radius: 9999px;
            transition: width 0.5s ease-out;
        }
        
        /* é«˜äº®æœ€è¿‘çš„èŠ‚æ—¥ */
        .highlight-holiday {
            background-color: var(--accent-color-highlight);
            border-left: 3px solid var(--accent-color);
        }

        #holiday-list-container {
            transition: opacity 0.1s ease-in-out;
        }
        #holiday-list-year {
            transition: opacity 0.1s ease-in-out, color 0.2s ease-in-out;
        }
        #holiday-list-year:hover {
            color: var(--accent-color);
        }

        #holiday-list-container-wrapper {
            --fade-top-size: 40px;
            --fade-bottom-size: 40px;
            -webkit-mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
            mask-image: linear-gradient(transparent, black var(--fade-top-size), black calc(100% - var(--fade-bottom-size)), transparent);
        }

        #back-to-today-btn {
            display: flex;
            border: 1px solid var(--card-border-color);
            background-color: var(--accent-color);
            opacity: 0;
            transform: scale(0.9);
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out, visibility 0.2s, background-color 0.2s ease;
        }
        #back-to-today-btn:hover {
            opacity: 0.85 !important;
        }
        #back-to-today-btn.visible {
            opacity: 0.7;
            transform: scale(1);
            visibility: visible;
            pointer-events: auto;
        }

        #main-wrapper {
            height: 100vh;
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out, opacity 0.2s ease-in-out;
        }
        
        /* --- Settings Modal States --- */
        #settings-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out, visibility 0s linear 0.2s;
        }
        #settings-window {
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.15s ease-in-out;
        }

        body.settings-open #main-wrapper {
            transform: scale(0.98);
            filter: blur(8px);
            opacity: 0;
            pointer-events: none;
        }
        body.settings-open #settings-overlay {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }
        body.settings-open #settings-window {
            transform: scale(1);
            opacity: 1;
        }

    @media (max-width: 1023px) {
        html, body {
            height: auto;
            overflow-y: auto;
        }
        #main-wrapper {
            height: auto;
        }
        #holiday-list-card {
            height: 50vh;
        }
    }

    /* Animations for Year Input */
    @keyframes fade-in-anim {
        from { opacity: 0; transform: scale(0.98); }
        to { opacity: 1; transform: scale(1); }
    }

    @keyframes fade-out-anim {
        from { opacity: 1; transform: scale(1); }
        to { opacity: 0; transform: scale(0.98); }
    }

    .animate-fade-in {
        animation: fade-in-anim 0.1s ease-out forwards;
    }

    .animate-fade-out {
        animation: fade-out-anim 0.1s ease-in forwards;
    }
    
    /* Shake animation for error feedback */
    @keyframes shake-anim {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-3px); }
      40%, 60% { transform: translateX(3px); }
    }

    #year-input.invalid {
        border-color: #ef4444 !important; /* red-500, a consistent error color */
        animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }

    /* GitHub Chart Placeholder Styles */
    #gh-chart-wrapper {
        aspect-ratio: 892 / 140;
        border-radius: 0.375rem; /* 6px */
        overflow: hidden;
    }

    @keyframes gh-chart-pulse {
        0%, 100% {
            opacity: 0.5;
        }
        50% {
            opacity: 1;
        }
    }

    #gh-chart-loader {
        background-color: var(--progress-bar-bg);
        animation: gh-chart-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    #gh-chart-img.loaded {
        opacity: 1;
    }

    #gh-chart-link.visible {
        visibility: visible;
    }

    #gh-chart-error.visible {
        display: flex;
    }

    /* --- Settings UI Styles --- */
    .setting-section {
        border-top: 1px solid var(--separator-color);
        padding-top: 1.5rem;
    }
    .setting-section:first-child {
        border-top: none;
        padding-top: 0;
    }
    .setting-radio-label {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease-in-out;
        border: 1px solid transparent;
    }
    .setting-radio-label:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }
    .setting-radio-input {
        display: none; /* Hide original radio button */
    }
    .setting-radio-input:checked + .setting-radio-label {
        background-color: rgba(56, 189, 248, 0.15);
        border-color: rgba(56, 189, 248, 0.5);
    }
    .custom-radio-button {
        width: 1.25em;
        height: 1.25em;
        border: 2px solid #9ca3af; /* gray-400 */
        border-radius: 50%;
        margin-right: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: border-color 0.2s;
        flex-shrink: 0;
    }
    .setting-radio-input:checked + .setting-radio-label .custom-radio-button {
        border-color: #38bdf8; /* sky-500 */
    }
    .custom-radio-button::after {
        content: '';
        width: 0.75em;
        height: 0.75em;
        background-color: #38bdf8; /* sky-500 */
        border-radius: 50%;
        transform: scale(0);
        transition: transform 0.15s ease-in-out;
    }
    .setting-radio-input:checked + .setting-radio-label .custom-radio-button::after {
        transform: scale(1);
    }

    #default-bg-options {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out, padding-top 0.3s ease;
        opacity: 0;
        padding-left: 0.5rem; /* Symmetrical padding */
        padding-right: 0.5rem; /* Symmetrical padding */
    }
    #default-bg-options.open {
        max-height: 300px; /* Adjust as needed */
        opacity: 1;
        padding-top: 0.75rem;
        padding-bottom: 0.5rem; /* Add space for hover effect */
    }
    .thumb-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.75rem;
        justify-content: center;
    }
    .thumb-item {
        aspect-ratio: 16 / 9;
        border-radius: 0.5rem; /* Softer corners */
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s, transform 0.2s;
        position: relative;
        background-color: rgba(255, 255, 255, 0.05);
    }
    .thumb-item:hover {
        transform: scale(1.05);
    }
    .thumb-item.active {
        border-color: #38bdf8; /* sky-500 */
    }
    .thumb-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .thumb-item .thumb-overlay {
        position: absolute;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.875rem;
    }

    .theme-swatch {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        cursor: pointer;
        padding: 4px;
        border: 2px solid transparent;
        transition: border-color 0.2s, transform 0.2s;
    }
    .theme-swatch:hover {
        transform: scale(1.1);
    }
    .theme-swatch.active {
        border-color: var(--accent-color);
        transform: scale(1.1);
    }
    .swatch-color {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    body.theme-light .swatch-color {
        border-color: rgba(0, 0, 0, 0.2);
    }

    .setting-btn-group {
        display: flex;
        border-radius: 0.5rem;
        overflow: hidden;
        border: 1px solid var(--separator-color);
    }
    .setting-btn {
        flex-grow: 1;
        padding: 0.5rem 0.75rem;
        background-color: transparent;
        color: var(--text-color-secondary);
        border: none;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        font-size: 0.875rem;
    }
    .setting-btn:not(:last-child) {
        border-right: 1px solid var(--separator-color);
    }
    .setting-btn.active {
        background-color: var(--accent-color);
        color: white;
        font-weight: 500;
    }
    .setting-btn:hover:not(.active) {
        background-color: var(--card-hover-bg-color);
    }

    .progress-bar-text {
        color: var(--text-color-primary);
        text-shadow: 0 0 4px rgba(0,0,0,0.5);
    }
    body.theme-light .progress-bar-text {
        /* In light mode, the primary text is dark, so a light shadow is better for contrast against the accent-colored bar */
        text-shadow: 0 0 4px rgba(255,255,255,0.5);
    }
    
    /* --- Toggle Switch --- */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 52px;
        height: 28px;
    }
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--text-color-tertiary);
        transition: .3s;
        border-radius: 28px;
    }
    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-radius: 50%;
    }
    input:checked + .toggle-slider {
        background-color: var(--accent-color);
    }
    input:focus + .toggle-slider {
        box-shadow: 0 0 1px var(--accent-color);
    }
    input:checked + .toggle-slider:before {
        transform: translateX(24px);
    }
    </style>
</head>
<body>
    <div id="bg-container"></div>
    <div id="main-wrapper">
        <div class="flex items-center justify-center min-h-screen px-8 sm:px-16 lg:px-24">
            <main class="grid grid-cols-1 lg:grid-cols-4 gap-5 w-full max-w-6xl">

                <div class="lg:col-span-1 space-y-5 flex flex-col">
                    <div class="glass-card flex items-center justify-center p-5 gap-4">
                        <h1 class="text-3xl font-bold" style="color: var(--text-color-primary);">Qing90bing</h1>
                    </div>

                    <div id="countdown-card" class="glass-card p-5 cursor-pointer">
                        <h2 class="text-xl font-semibold mb-3 text-center" style="color: var(--text-color-primary);">æ—¥å†å€’è®¡æ—¶</h2>
                        <div id="countdown-display" class="text-center text-lg leading-relaxed" style="color: var(--accent-color);">æ­£åœ¨è®¡ç®—...</div>
                    </div>
                    
                    <div id="profile-card" class="glass-card p-5 flex flex-col justify-between flex-grow cursor-pointer">
                        <div class="relative px-4 py-2">
                            <span class="absolute top-0 left-0 text-6xl font-serif -translate-y-4 -translate-x-2 select-none" style="color: var(--separator-color);">â€œ</span>
                            <p class="text-lg" style="color: var(--text-color-primary);">Hello, World!</p>
                            <p class="mt-1" style="color: var(--text-color-secondary);">ä¸€ä¸ªå»ºç«‹äº21ä¸–çºªçš„å°ç«™ï¼Œå­˜æ´»äºäº’è”ç½‘çš„è¾¹ç¼˜</p>
                            <span class="absolute bottom-0 right-0 text-6xl font-serif translate-y-6 translate-x-2 select-none" style="color: var(--separator-color);">â€</span>
                        </div>
                        <div class="mt-8">
                            <p class="text-sm mb-4" style="color: var(--text-color-secondary);">ä¸æˆ‘è”ç³»:</p>
                            <div class="flex items-center gap-5">
                                <a href="https://github.com/Qing90bing" target="_blank" title="GitHub" style="color: var(--text-color-secondary); transition: color 0.2s;">
                                    <svg class="w-7 h-7" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
                                </a>
                                <a href="mailto:1879495519@qq.com" target="_blank" title="Email" style="color: var(--text-color-secondary); transition: color 0.2s;">
                                    <svg class="w-7 h-7" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Email</title><path fill="currentColor" d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/></svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="right-column" class="lg:col-span-3 space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="glass-card p-5 flex flex-col justify-center items-center">
                            <div id="date-display" class="text-lg" style="color: var(--text-color-secondary);"></div>
                            <div id="time-display" class="text-6xl my-1" style="color: var(--text-color-primary);"></div>
                            <div id="greeting" class="text-sm" style="color: var(--text-color-secondary);"></div>
                        </div>
                        <div id="hitokoto-card" class="glass-card p-5 flex flex-col justify-center cursor-pointer min-h-[120px] md:min-h-full">
                            <p id="hitokoto-text" class="text-center transition-opacity duration-500 ease-in-out" style="color: var(--text-color-primary);">æ­£åœ¨åŠ è½½ä¸€è¨€...</p>
                            <p id="hitokoto-from" class="text-right text-sm mt-2 transition-opacity duration-500 ease-in-out" style="color: var(--text-color-secondary);"></p>
                        </div>
                    </div>
                    
                    <div class="glass-card p-5">
                        <div id="main-card-view-wrapper">
                            <!-- GitHub View -->
                            <div id="github-view">
                                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color-primary);">
                                   <svg class="inline-block w-6 h-6 mr-2 -mt-1" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
                                   GitHub è´¡çŒ®å›¾
                                </h2>
                                <div id="gh-chart-container" class="w-full rounded-md p-2" style="background-color: var(--progress-bar-bg);">
                                    <div id="gh-chart-wrapper" class="relative">
                                        <div id="gh-chart-loader" class="absolute inset-0 flex items-center justify-center"></div>
                                        <div id="gh-chart-error" class="absolute inset-0 hidden flex-col items-center justify-center cursor-pointer">
                                            <svg class="w-8 h-8" style="color: var(--text-color-tertiary);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-2.695v-2.286c0-1.033-.842-1.875-1.875-1.875H10.5a1.875 1.875 0 00-1.875 1.875v2.286m7.5 0l-3.181 3.183m0 0L12 21.354l-3.181-3.183m0 0l-3.181-3.183"></path></svg>
                                            <p id="gh-chart-error-message" class="mt-2 text-sm" style="color: var(--text-color-secondary);">åŠ è½½è´¡çŒ®å›¾å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•</p>
                                        </div>
                                        <a href="https://github.com/Qing90bing" target="_blank" id="gh-chart-link" class="invisible">
                                            <img id="gh-chart-img" data-src="https://ghchart.rshah.org/Qing90bing?theme=dark" alt="Qing90bing's GitHub Contribution Graph" class="w-full h-full block opacity-0 transition-opacity duration-500"/>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <!-- Weather View -->
                            <div id="weather-view" class="hidden">
                                 <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color-primary);">å¤©æ°”ä¿¡æ¯</h2>
                                 <div id="weather-content-wrapper" class="w-full rounded-md p-2" style="background-color: var(--progress-bar-bg);">
                                    <!-- Weather content will be injected here -->
                                    <p style="color: var(--text-color-secondary);">æ­£åœ¨åŠ è½½å¤©æ°”...</p>
                                 </div>
                            </div>
                        </div>

                        <h2 class="text-xl font-semibold mb-4 mt-6" style="color: var(--text-color-primary);">
                            <svg class="inline-block w-6 h-6 mr-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                            ç½‘ç«™åˆ—è¡¨
                        </h2>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                            <a href="https://qing90bing.github.io/QingNoteblog/" target="_blank" class="glass-card p-4 flex flex-col items-center justify-center text-center hover:scale-105 transform-gpu" style="color: var(--text-color-primary);">
                                <svg class="w-8 h-8 mb-2" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 4v12l-4-2-4 2V4M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                <span class="font-medium">åšå®¢</span>
                            </a>
                            <a href="https://qing90bing.github.io/Qing_Music/" target="_blank" class="glass-card p-4 flex flex-col items-center justify-center text-center hover:scale-105 transform-gpu" style="color: var(--text-color-primary);">
                                <svg class="w-8 h-8 mb-2" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"></path></svg>
                                <span class="font-medium">éŸ³ä¹</span>
                            </a>
                            <a href="https://qing90bing.github.io/Qing_Start/" target="_blank" class="glass-card p-4 flex flex-col items-center justify-center text-center hover:scale-105 transform-gpu" style="color: var(--text-color-primary);">
                                <svg class="w-8 h-8 mb-2" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                                <span class="font-medium">èµ·å§‹é¡µ</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Holiday List Card -->
                <div id="holiday-list-card" class="lg:col-span-3 glass-card p-5 hidden flex flex-col">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold" style="color: var(--text-color-primary);">èŠ‚æ—¥å€’æ•°åˆ—è¡¨</h2>
                        <div class="flex items-center gap-3">
                            <button id="back-to-today-btn" title="å›åˆ°ä»Šå¤©" class="w-8 h-8 rounded-full transition-all active:scale-95 flex-shrink-0 flex items-center justify-center font-bold text-white text-base">ä»Š</button>
                            <button id="close-holiday-list" title="å…³é—­" class="transition-colors" style="color: var(--text-color-secondary);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-center items-center h-8 relative">
                        <!-- Display Mode -->
                        <div id="year-display-controls" class="flex items-center gap-4 text-lg">
                            <button id="prev-year" title="ä¸Šä¸€å¹´" class="p-1 rounded-full transition-all active:scale-95" style="color: var(--text-color-secondary);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            </button>
                            <span id="holiday-list-year" class="font-bold w-16 text-center cursor-pointer" style="color: var(--text-color-primary);"></span>
                            <button id="next-year" title="ä¸‹ä¸€å¹´" class="p-1 rounded-full transition-all active:scale-95" style="color: var(--text-color-secondary);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>
                        <!-- Edit Mode -->
                        <div id="year-edit-controls" class="hidden flex items-center gap-2 text-lg">
                            <input type="text" id="year-input" class="font-bold w-20 text-center rounded-md border focus:ring-0 px-1 py-0.5 text-lg" style="background-color: var(--card-bg-color); color: var(--text-color-primary); border-color: var(--separator-color); outline: none;">
                            <button id="confirm-year-btn" title="ç¡®è®¤" class="p-1 rounded-full hover:bg-white/10 transition-all active:scale-95" style="color: var(--status-today);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            </button>
                            <button id="cancel-year-btn" title="å–æ¶ˆ" class="p-1 rounded-full hover:bg-white/10 transition-all active:scale-95" style="color: #ef4444;">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        <!-- Error Message for input validation -->
                        <div id="year-input-error" class="hidden absolute -bottom-6 text-sm font-bold" style="color: #ef4444;"></div>
                    </div>
                    <div class="relative flex-1 min-h-0">
                        <!-- Warning is now absolutely positioned inside this container -->
                        <div id="year-range-warning" class="absolute top-0 left-0 right-0 z-10 hidden flex items-center justify-center text-amber-400 text-sm font-semibold"></div>
                        <div id="holiday-list-container-wrapper" class="absolute inset-0">
                           <div id="holiday-list-container" class="space-y-4">
                               <!-- Holiday list will be dynamically inserted here -->
                           </div>
                        </div>
                    </div>
                </div>

                <!-- Time Capsule Card -->
                <div id="time-capsule-card" class="lg:col-span-3 glass-card p-5 hidden flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold" style="color: var(--text-color-primary);">æ—¶å…‰èƒ¶å›Š</h2>
                        <div class="flex items-center gap-4">
                            <button id="open-settings-btn" title="è®¾ç½®" class="transition-colors" style="color: var(--text-color-secondary);">
                                <i class="fas fa-gear fa-lg"></i>
                            </button>
                            <button id="close-time-capsule" title="å…³é—­" class="transition-colors" style="color: var(--text-color-secondary);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-y-5">
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm font-medium" style="color: var(--text-color-secondary);">
                                <span>ä»Šæ—¥å·²è¿‡ <span id="day-passed">0</span> å°æ—¶</span>
                                <span>å‰©ä½™ <span id="day-left">24</span> å°æ—¶</span>
                            </div>
                            <div class="progress-bar h-5 flex items-center justify-center relative">
                                <div id="day-progress" class="progress-bar-inner absolute top-0 left-0 h-full" style="width: 0%;"></div>
                                <span id="day-percent" class="relative z-10 text-xs font-bold progress-bar-text">0%</span>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm font-medium" style="color: var(--text-color-secondary);">
                                <span>æœ¬å‘¨å·²è¿‡ <span id="week-passed">0</span> å¤©</span>
                                <span>å‰©ä½™ <span id="week-left">7</span> å¤©</span>
                            </div>
                            <div class="progress-bar h-5 flex items-center justify-center relative">
                                <div id="week-progress" class="progress-bar-inner absolute top-0 left-0 h-full" style="width: 0%;"></div>
                                <span id="week-percent" class="relative z-10 text-xs font-bold progress-bar-text">0%</span>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm font-medium" style="color: var(--text-color-secondary);">
                                <span>æœ¬æœˆå·²è¿‡ <span id="month-passed">0</span> å¤©</span>
                                <span>å‰©ä½™ <span id="month-left">30</span> å¤©</span>
                            </div>
                            <div class="progress-bar h-5 flex items-center justify-center relative">
                                <div id="month-progress" class="progress-bar-inner absolute top-0 left-0 h-full" style="width: 0%;"></div>
                                <span id="month-percent" class="relative z-10 text-xs font-bold progress-bar-text">0%</span>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm font-medium" style="color: var(--text-color-secondary);">
                                <span>ä»Šå¹´å·²è¿‡ <span id="year-passed">0</span> å¤©</span>
                                <span>å‰©ä½™ <span id="year-left">365</span> å¤©</span>
                            </div>
                            <div class="progress-bar h-5 flex items-center justify-center relative">
                                <div id="year-progress" class="progress-bar-inner absolute top-0 left-0 h-full" style="width: 0%;"></div>
                                <span id="year-percent" class="relative z-10 text-xs font-bold progress-bar-text">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 text-center" style="color: var(--text-color-secondary);">
                        <p id="site-runtime-display">æ­£åœ¨è®¡ç®—...</p>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-overlay" class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center p-4" style="z-index: 50;">
        <div id="settings-window" class="glass-card w-full max-w-2xl p-5 flex flex-col">
            <!-- Header -->
            <div class="flex justify-between items-center ">
                <h2 class="text-xl font-semibold" style="color: var(--text-color-primary);">è®¾ç½®</h2>
                <button id="close-settings-btn" title="å…³é—­" style="color: var(--text-color-secondary);">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <!-- Content -->
            <div class="flex-grow flex-1 min-h-0" data-simplebar>
                <div class="space-y-6 p-3">
                    <!-- 1. Background Settings -->
                    <div class="setting-section">
                        <h3 class="text-lg font-semibold mb-3" style="color: var(--text-color-primary);">èƒŒæ™¯æ¥æº</h3>
                        <div id="background-settings-content" class="space-y-2">
                            <!-- Background options will be dynamically inserted here -->
                        </div>
                    </div>

                    <!-- 2. Theme Color Settings -->
                    <div class="setting-section">
                        <h3 class="text-lg font-semibold mb-3" style="color: var(--text-color-primary);">ä¸»é¢˜æ¨¡å¼</h3>
                        <div id="theme-settings-content" class="flex flex-wrap gap-4">
                            <!-- Theme color swatches will be dynamically inserted here -->
                        </div>
                    </div>

                    <!-- 3. GitHub/Weather Toggle -->
                    <div class="setting-section">
                        <h3 class="text-lg font-semibold mb-3" style="color: var(--text-color-primary);">ä¸»å¡ç‰‡è§†å›¾</h3>
                        <div id="view-toggle-content">
                            <!-- The toggle switch for GitHub/Weather will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- åˆå§‹çŠ¶æ€å’Œå¸¸é‡ ---
        const DEFAULT_BG_IMAGES = [
            'https://s21.ax1x.com/2025/08/10/pVdEmM6.jpg',
            'https://s21.ax1x.com/2025/08/10/pVdEnsK.jpg',
            'https://s21.ax1x.com/2025/08/10/pVdEuqO.jpg',
            'https://s21.ax1x.com/2025/08/10/pVdEQde.jpg',
            'https://s21.ax1x.com/2025/08/10/pVdEMZD.jpg'
        ];
        const lunarInfo = [0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2, 0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977, 0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970, 0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950, 0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557, 0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5d0, 0x14573, 0x052d0, 0x0a9a8, 0x0e950, 0x06aa0, 0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0, 0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b5a0, 0x195a6, 0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570, 0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0, 0x0c960, 0xd954, 0x0d4a0, 0xda50, 0x07552, 0x056a0, 0xabb7, 0x025d0, 0x092d0, 0x0cab5, 0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930, 0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530, 0x05aa0, 0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45, 0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0];
        const solarTerm = ["å°å¯’", "å¤§å¯’", "ç«‹æ˜¥", "é›¨æ°´", "æƒŠè›°", "æ˜¥åˆ†", "æ¸…æ˜", "è°·é›¨", "ç«‹å¤", "å°æ»¡", "èŠ’ç§", "å¤è‡³", "å°æš‘", "å¤§æš‘", "ç«‹ç§‹", "å¤„æš‘", "ç™½éœ²", "ç§‹åˆ†", "å¯’éœ²", "éœœé™", "ç«‹å†¬", "å°é›ª", "å¤§é›ª", "å†¬è‡³"];
        const sTermInfo = [0, 21208, 42467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693, 263343, 285989, 308563, 331033, 353350, 375494, 397447, 419210, 440795, 462224, 483532, 504758];
        const sFtv = [
            { date: "0101", name: "å…ƒæ—¦", start: 1949 },
            { date: "0110", name: "è­¦å¯ŸèŠ‚", start: 2021 },
            { date: "0214", name: "æƒ…äººèŠ‚" },
            { date: "0308", name: "å¦‡å¥³èŠ‚", start: 1949 },
            { date: "0312", name: "æ¤æ ‘èŠ‚", start: 1979 },
            { date: "0315", name: "æ¶ˆè´¹è€…æ—¥", start: 1983 },
            { date: "0401", name: "æ„šäººèŠ‚" },
            { date: "0501", name: "åŠ³åŠ¨èŠ‚", start: 1949 },
            { date: "0504", name: "é’å¹´èŠ‚", start: 1949 },
            { date: "0512", name: "æŠ¤å£«èŠ‚", start: 1912 },
            { date: "0601", name: "å„¿ç«¥èŠ‚", start: 1949 },
            { date: "0701", name: "å»ºå…šèŠ‚", start: 1921 },
            { date: "0801", name: "å»ºå†›èŠ‚", start: 1927 },
            { date: "0815", name: "æ—¥æœ¬æŠ•é™æ—¥", start: 1945 },
            { date: "0903", name: "æŠ—æˆ˜èƒœåˆ©çºªå¿µæ—¥", start: 1945 },
            { date: "0910", name: "æ•™å¸ˆèŠ‚", start: 1985 },
            { date: "0918", name: "ä¹ä¸€å…«äº‹å˜", start: 1931 },
            { date: "1001", name: "å›½åº†èŠ‚", start: 1949 },
            { date: "1213", name: "å›½å®¶å…¬ç¥­æ—¥", start: 2014 },
            { date: "1224", name: "å¹³å®‰å¤œ" },
            { date: "1225", name: "åœ£è¯èŠ‚" },
        ];
        const lFtv = [
            { date: "0101", name: "æ˜¥èŠ‚" },
            { date: "0115", name: "å…ƒå®µèŠ‚" },
            { date: "0202", name: "é¾™æŠ¬å¤´" },
            { date: "0505", name: "ç«¯åˆèŠ‚" },
            { date: "0707", name: "ä¸ƒå¤•" },
            { date: "0715", name: "ä¸­å…ƒèŠ‚" },
            { date: "0815", name: "ä¸­ç§‹èŠ‚" },
            { date: "0909", name: "é‡é˜³èŠ‚" },
            { date: "1208", name: "è…Šå…«èŠ‚" },
            { date: "1223", name: "åŒ—æ–¹å°å¹´" },
            { date: "1224", name: "å—æ–¹å°å¹´" },
        ];
        let holidayListDisplayedYear = new Date().getFullYear();
        let hasManuallyScrolled = false;
        let holidayListSimpleBar; // Instance for the holiday list scrollbar
        let settingsSimpleBar = null; // Instance for the settings scrollbar

        // --- DOM å…ƒç´ è·å– ---
        const bgContainer = document.getElementById('bg-container');
        const countdownCard = document.getElementById('countdown-card');
        const profileCard = document.getElementById('profile-card');
        const rightColumn = document.getElementById('right-column');
        const timeCapsuleCard = document.getElementById('time-capsule-card');
        const holidayListCard = document.getElementById('holiday-list-card');
        let rightColumnInitialHeight = 0;
        let cachedRightColumnHeight = 0; // Cache the height of the right column

        // --- [NEW] Year Input Feature Elements ---
        const yearDisplayControls = document.getElementById('year-display-controls');
        const yearEditControls = document.getElementById('year-edit-controls');
        const holidayListYearSpan = document.getElementById('holiday-list-year');
        const yearInput = document.getElementById('year-input');
        const confirmYearBtn = document.getElementById('confirm-year-btn');
        const cancelYearBtn = document.getElementById('cancel-year-btn');
        const yearInputError = document.getElementById('year-input-error');
        const yearRangeWarning = document.getElementById('year-range-warning');

        // --- è®¾ç½®éšæœºèƒŒæ™¯å›¾ç‰‡ ---
        function setRandomBackground() {
            const randomImageUrl = DEFAULT_BG_IMAGES[Math.floor(Math.random() * DEFAULT_BG_IMAGES.length)];
            const img = new Image();
            img.src = randomImageUrl;
            img.onload = () => {
                bgContainer.style.backgroundImage = `url('${randomImageUrl}')`;
                bgContainer.style.opacity = 1;
            };
        }
        
        // --- åŠ¨æ€æ—¶é’ŸåŠŸèƒ½ ---
        function updateTime() {
            const timeDisplay = document.getElementById('time-display');
            const dateDisplay = document.getElementById('date-display');
            const now = new Date();
            timeDisplay.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            dateDisplay.textContent = `${now.getFullYear()}å¹´${String(now.getMonth() + 1).padStart(2, '0')}æœˆ${String(now.getDate()).padStart(2, '0')}æ—¥ ${weekdays[now.getDay()]}`;
        }

        // --- é—®å€™è¯­åŠŸèƒ½ ---
        function updateGreeting() {
            const greetingEl = document.getElementById('greeting');
            const now = new Date();
            const hour = now.getHours();
            const month = now.getMonth() + 1; // getMonth() è¿”å› 0-11, +1 å˜ä¸º 1-12

            // å®šä¹‰é—®å€™è¯­åº“
            const greetings = {
                spring: { // æ˜¥å­£ (3-5æœˆ)
                    morning: [
                        "æ—©ä¸Šå¥½ï¼Œæ˜¥æ„ç›ç„¶ï¼Œæ„¿ä½ çš„ä¸€å¤©å¦‚è¯—å¦‚ç”»ã€‚ğŸŒ¿",
                        "æ¸…æ™¨çš„éœ²æ°´ï¼Œä¼´ç€èŠ±é¦™ï¼Œé“ä¸€å£°æ—©å®‰ã€‚ğŸŒ¸",
                        "æ˜¥æ—¥é»æ˜ï¼Œä¸‡ç‰©å¤è‹ï¼Œä»Šå¤©ä¹Ÿè¦æ´»åŠ›æ»¡æ»¡ï¼",
                        "æ—©å®‰ï¼Œæ„¿æ˜¥é£ä¸ºä½ å¹æ¥ä¸€å¤©çš„å¥½è¿ã€‚ğŸƒ",
                        "å¬ï¼Œçª—å¤–æ˜¯ä¸æ˜¯æœ‰é¸Ÿå„¿åœ¨æ­Œå”±ï¼Ÿæ—©å®‰ï¼ğŸ¦",
                        "æ–°çš„ä¸€å¤©ï¼Œä»ä¸€ä¸ªæ¸…æ–°çš„æ˜¥æ—¥æ—©æ™¨å¼€å§‹ã€‚",
                        "ä¸€å¹´ä¹‹è®¡åœ¨äºæ˜¥ï¼Œä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼ŒåŠ æ²¹ï¼",
                        "æ‹‰å¼€çª—å¸˜ï¼Œè®©ç¬¬ä¸€ç¼•æ˜¥å…‰æ‹¥æŠ±ä½ ã€‚â˜€ï¸"
                    ],
                    afternoon: [
                        "ä¸‹åˆå¥½ï¼Œæ˜¥æ—¥æš–é˜³ï¼Œé€‚åˆå°æ†©ç‰‡åˆ»ã€‚â˜€ï¸",
                        "åˆåæ—¶å…‰ï¼Œæ³¡æ¯èŠ±èŒ¶ï¼Œäº«å—æ˜¥æ—¥çš„æ‚ é—²å§ã€‚ğŸµ",
                        "æ„¿ä½ å¿ƒæƒ…å¦‚æ˜¥æ—¥åˆåçš„é˜³å…‰ï¼Œæ˜åªšä¸å¿§ä¼¤ã€‚",
                        "æ˜¥å¤©åˆ°ï¼Œåˆ«æ˜¥å›°ï¼Œèµ·æ¥æ´»åŠ¨ä¸€ä¸‹ç­‹éª¨å§ï¼",
                        "å¤©æ°”è¿™ä¹ˆå¥½ï¼Œä¸å»å…¬å›­æ•£æ•£æ­¥å—ï¼Ÿ",
                        "åˆåçš„é˜³å…‰ï¼Œæš–å¾—è®©äººæƒ³æ‰“çŒç¡ã€‚ğŸ˜´",
                        "æ³¡ä¸€å£¶é¾™äº•ï¼Œé™å“æ˜¥æ—¥çš„åˆåæ—¶å…‰ã€‚",
                        "æ˜¥é›·é˜µé˜µï¼Œè¯´ä¸å®šä¼šæœ‰ä¸€åœºæ˜¥é›¨ï¼Œè®°å¾—å¸¦ä¼ã€‚"
                    ],
                    evening: [
                        "æ™šä¸Šå¥½ï¼Œæ˜¥é£æ‹‚é¢ï¼Œä¸€å¤©çš„ç–²æƒ«éƒ½æ¶ˆæ•£äº†ã€‚ğŸ‘",
                        "å¤œå¹•é™ä¸´ï¼Œé™äº«æ˜¥å¤œçš„æ¸©æŸ”ä¸å®é™ã€‚",
                        "æ˜¥å¤œçš„æ˜Ÿç©ºæ ¼å¤–æ˜æœ—ï¼Œç¥ä½ æ™šå®‰å¥½æ¢¦ã€‚âœ¨",
                        "åœ¨æ¸©æŸ”çš„æ˜¥å¤œé‡Œï¼Œå’Œä¸–ç•Œé“ä¸€å¥æ™šå®‰ã€‚",
                        "æ˜¥å¤©çš„æ™šéœæ€»æ˜¯æ ¼å¤–æ¸©æŸ”ï¼Œæ™šä¸Šå¥½ã€‚",
                        "å¿™ç¢Œäº†ä¸€å¤©ï¼Œæ˜¯æ—¶å€™äº«å—ä¸€é¡¿ç¾å‘³çš„æ™šé¤äº†ã€‚ğŸ²",
                        "æ™šé£è½»è½»ï¼Œå¹æ¥é’è‰å’Œæ³¥åœŸçš„èŠ¬èŠ³ã€‚",
                        "ä»Šæ™šæœˆè‰²çœŸç¾ï¼Œé£ä¹Ÿæ¸©æŸ”ï¼Œç¥ä½ æ„‰å¿«ã€‚"
                    ],
                    night: [
                        "å¤œæ·±äº†ï¼Œæ˜¥å¤œå¾®å‡‰ï¼Œè®°å¾—ç›–å¥½è¢«å­ã€‚ğŸŒ™",
                        "æ™šå®‰ï¼Œæ„¿ä½ åœ¨æ¢¦é‡Œä¸æœ€ç¾çš„æ˜¥å¤©ç›¸é‡ã€‚",
                        "æ”¾ä¸‹æ‰‹æœºï¼Œé—­ä¸Šçœ¼ç›ï¼Œè†å¬æ˜¥è™«çš„é¸£å«ã€‚ğŸ˜´",
                        "å¤œé˜‘äººé™ï¼Œç¥ä½ å®‰çœ ï¼Œæ˜æ—¥åˆæ˜¯å´­æ–°çš„ä¸€å¤©ã€‚",
                        "æ˜¥å¤œå®é™ï¼Œå®œè¯»ä¸€æœ¬é—²ä¹¦ï¼Œå®‰ç„¶å…¥ç¡ã€‚",
                        "æŠŠä»Šå¤©ä»½çš„å¼€å¿ƒæ‰“åŒ…ï¼Œç¡ä¸ªå¥½è§‰å§ã€‚",
                        "æ™šå®‰ï¼Œæ„¿ä½ çš„æ¢¦é‡Œç¹èŠ±ä¼¼é”¦ã€‚ğŸŒ¸",
                        "å¤œäº†ï¼Œå…¨ä¸–ç•Œéƒ½ç¡äº†ï¼Œä½ ä¹Ÿè¦æ—©ç‚¹ä¼‘æ¯ã€‚"
                    ]
                },
                summer: { // å¤å­£ (6-8æœˆ)
                    morning: [
                        "æ—©ä¸Šå¥½ï¼Œå¤æ—¥æ¸…æ™¨ï¼Œé˜³å…‰æ­£å¥½ï¼Œå¾®é£ä¸ç‡¥ã€‚â˜€ï¸",
                        "æ—©å®‰ï¼ä»Šå¤©ä¹Ÿæ˜¯å…ƒæ°”æ»¡æ»¡çš„ä¸€å¤©ï¼Œåˆ«æ€•çƒ­ï¼",
                        "å¤æ—¥çš„æ¸…æ™¨ï¼Œæ˜¯è¥¿ç“œå‘³çš„ï¼Œæ˜¯å†°æ±½æ°´å‘³çš„ã€‚ğŸ‰",
                        "è‰é¸£å£°å£°ï¼Œå”¤é†’äº†å¤å¤©çš„æ—©æ™¨ï¼Œæ—©å®‰ï¼",
                        "æ—©å®‰ï¼ä»Šå¤©çš„å¤ªé˜³ä¹Ÿå¾ˆçƒ­æƒ…å‘¢ï¼",
                        "èµ¶åœ¨çƒ­æµªæ¥ä¸´å‰ï¼Œäº«å—æ¸…æ™¨çš„ç‰‡åˆ»å‡‰çˆ½å§ã€‚",
                        "åˆæ˜¯è¢«é˜³å…‰å«é†’çš„ä¸€å¤©ï¼Œä½ å¥½å‘€ï¼ğŸŒ",
                        "æ–°çš„ä¸€å¤©ï¼ŒåƒåŠ äº†å†°å—çš„æ±½æ°´ï¼Œå……æ»¡æ´»åŠ›ï¼"
                    ],
                    afternoon: [
                        "ä¸‹åˆå¥½ï¼Œå¤æ—¥ç‚ç‚ï¼Œè®°å¾—å¤šå–æ°´é˜²æš‘å“¦ã€‚ğŸ’§",
                        "åˆåå›°å€¦ï¼Œæ¥æ ¹å†°æ£ææç¥å§ï¼ğŸ¦",
                        "å¿ƒé™è‡ªç„¶å‡‰ï¼Œæ„¿ä½ æ‹¥æœ‰ä¸€ä¸ªæ¸…çˆ½çš„ä¸‹åˆã€‚",
                        "å¤æ—¥åˆåï¼Œå®œå¼€ç©ºè°ƒï¼Œå®œå¬éŸ³ä¹ï¼Œå®œæƒ³ä½ ã€‚ğŸ˜‰",
                        "çƒ­åˆ°èåŒ–çš„ä¸‹åˆï¼Œä½ è¿˜å¥½å—ï¼Ÿ",
                        "â€œå“ªå„¿å‡‰å¿«å“ªå„¿å¾…ç€å»â€ç»å¯¹æ˜¯å¤å¤©æœ€çœŸè¯šçš„ç¥ç¦ã€‚",
                        "å¯èƒ½ä¼šæœ‰é›·é˜µé›¨ï¼Œå‡ºé—¨è®°å¾—å¸¦ä¼å“¦ã€‚â›ˆï¸",
                        "è¿™ä¸ªé’Ÿç‚¹ï¼Œå”¯æœ‰ç©ºè°ƒå’Œè¥¿ç“œä¸å¯è¾œè´Ÿã€‚ğŸ‰"
                    ],
                    evening: [
                        "æ™šä¸Šå¥½ï¼Œå¤å¤œæ™šé£ï¼Œå¹æ•£ç™½å¤©çš„ç‡¥çƒ­ã€‚ğŸ",
                        "æç€ä¸€ç“¶æ±½æ°´ï¼Œååœ¨å°é˜¶ä¸Šï¼Œæ„Ÿå—å¤å¤©çš„æ™šé£ã€‚",
                        "å±äºå¤å¤©çš„å¤œæ™šï¼Œæ˜¯çƒ§çƒ¤ã€å°é¾™è™¾å’Œå†°å•¤é…’ã€‚ğŸ»",
                        "æ™šé£è½»è¸©ç€äº‘æœµï¼Œæœˆäº®åœ¨è´©å”®å¿«ä¹ï¼Œæ™šå®‰ï¼",
                        "æ™šé£å¹èµ°äº†çƒ­æ°”ï¼Œå¸¦æ¥äº†å¤å¤œçš„æƒ¬æ„ã€‚",
                        "åˆåˆ°äº†å¯ä»¥å»å¤œå¸‚é€›åƒé€›åƒçš„å­£èŠ‚ï¼",
                        "å°æ—¶å€™çš„å¤å¤œï¼Œæ˜¯è’²æ‰‡ã€å‡‰å¸­å’Œæ»¡å¤©ç¹æ˜Ÿã€‚âœ¨",
                        "æ™šä¸Šå¥½ï¼Œå»æ•£æ•£æ­¥å§ï¼Œè¯´ä¸å®šèƒ½çœ‹åˆ°è¤ç«è™«ã€‚"
                    ],
                    night: [
                        "å¤œæ·±äº†ï¼Œæ™šå®‰ï¼Œæ„¿ä½ çš„æ¢¦é‡Œæœ‰å‡‰çˆ½çš„å¤é£ã€‚ğŸŒŒ",
                        "ä»²å¤å¤œä¹‹æ¢¦ï¼Œæ„¿ä½ æ‹¥æŠ±æ•´ç‰‡æ˜Ÿç©ºã€‚âœ¨",
                        "å…³æ‰ç©ºè°ƒï¼Œå¯èƒ½ä¼šçƒ­ï¼›ä¸å…³ï¼Œå¯èƒ½ä¼šæ„Ÿå†’ã€‚ä½ çœ‹ç€åŠå§ï¼",
                        "æ™šå®‰ï¼Œæœˆäº®è­¦å¯Ÿå·²å°±ä½ï¼Œè¯·å®‰å¿ƒå…¥ç¡ã€‚ğŸ‘®",
                        "å˜˜ï¼Œé™ä¸‹å¿ƒæ¥ï¼Œå¬å¬çª—å¤–çš„è™«é¸£ã€‚",
                        "æ™šå®‰ï¼Œç©ºè°ƒè°ƒåˆ°26åº¦åˆšåˆšå¥½å“¦ã€‚ğŸ˜‰",
                        "åˆ«ç†¬å¤œäº†ï¼Œä½ çš„çš®è‚¤å’Œå¤´å‘éƒ½éœ€è¦ä¼‘æ¯ã€‚",
                        "ç¥ä½ åšä¸ªå‡‰çˆ½çš„æ¢¦ï¼Œæ¢¦é‡Œæ²¡æœ‰èšŠå­ã€‚ğŸ¦Ÿ"
                    ]
                },
                autumn: { // ç§‹å­£ (9-11æœˆ)
                    morning: [
                        "æ—©ä¸Šå¥½ï¼Œç§‹é«˜æ°”çˆ½ï¼Œå¤©æœ—æ°”æ¸…ï¼Œåˆæ˜¯ç¾å¥½çš„ä¸€å¤©ã€‚ğŸ",
                        "æ—©å®‰ï¼Œç©ºæ°”ä¸­æœ‰äº†ç§‹å¤©çš„å‘³é“ï¼Œæ·±å‘¼å¸ä¸€ä¸‹å§ã€‚",
                        "ç§‹æ—¥çš„æ™¨å…‰ï¼Œæ¸©æŸ”åœ°æ´’åœ¨æ¯ä¸€ç‰‡è½å¶ä¸Šï¼Œæ—©å®‰ã€‚",
                        "å¤©å‡‰äº†ï¼Œè®°å¾—å¤šç©¿ä»¶è¡£æœï¼Œåˆ«æ„Ÿå†’äº†å“¦ã€‚ğŸ§¥",
                        "ç§‹æ—¥çš„å¤©ç©ºï¼Œè“å¾—åƒä¸€å—ç”»å¸ƒï¼Œæ—©å®‰ã€‚",
                        "æ—©æ™¨çš„ç©ºæ°”å¾®å‡‰ï¼Œè®°å¾—æ·»ä¸€ä»¶è–„å¤–å¥—ã€‚",
                        "ç§‹å¤©ï¼Œæ˜¯ä¸€ä¸ªè®©ä¸€åˆ‡éƒ½æ²‰é™ä¸‹æ¥çš„å­£èŠ‚ï¼Œæ—©ã€‚",
                        "åˆæ˜¯è¢«æ¢¦æƒ³å«é†’çš„ä¸€å¤©ï¼ŒåŠ æ²¹ï¼Œæ‰“å·¥äººï¼"
                    ],
                    afternoon: [
                        "ä¸‹åˆå¥½ï¼Œç§‹æ—¥çš„åˆåï¼Œé˜³å…‰æ¸©æš–å¾—åˆšåˆšå¥½ã€‚â˜•ï¸",
                        "æ§ä¸€æ¯çƒ­èŒ¶ï¼Œè¯»ä¸€æœ¬å¥½ä¹¦ï¼Œäº«å—ç§‹æ—¥çš„é™è°§ã€‚",
                        "ç§‹å¤©æ˜¯æ”¶è·çš„å­£èŠ‚ï¼Œæ„¿ä½ çš„åŠªåŠ›éƒ½æœ‰å›æŠ¥ã€‚",
                        "åˆå®‰ï¼Œæ„¿ç§‹é£å¸¦èµ°ä½ çš„çƒ¦æ¼å’Œç–²æƒ«ã€‚ğŸ‚",
                        "ç§‹æ—¥çš„åˆåï¼Œæ¯ä¸€å¸§éƒ½åƒç”µå½±ç”»é¢ã€‚ğŸ¬",
                        "é˜³å…‰æ­£å¥½ï¼Œæ¸©åº¦ä¹Ÿæ­£å¥½ï¼Œä¸€åˆ‡éƒ½åˆšåˆšå¥½ã€‚",
                        "æ¥å—çƒ¤çº¢è–¯æˆ–æ˜¯ç³–ç‚’æ —å­æ€ä¹ˆæ ·ï¼ŸğŸŒ°",
                        "ä¸‹åˆçŠ¯å›°çš„è¯ï¼Œå°±çœ‹çœ‹çª—å¤–çš„è“å¤©ç™½äº‘å§ã€‚"
                    ],
                    evening: [
                        "æ™šä¸Šå¥½ï¼Œç§‹é£é€çˆ½ï¼Œæœˆè‰²å®œäººã€‚ğŸŒ•",
                        "ä¸¹æ¡‚é£˜é¦™çš„å¤œæ™šï¼Œé€‚åˆæ€å¿µå’Œå›¢åœ†ã€‚",
                        "ç§‹å¤©çš„å¤œæ™šï¼Œæ˜¯æ€å¿µçš„å­£èŠ‚ï¼Œä¹Ÿæ˜¯å…»è†˜çš„å­£èŠ‚ã€‚",
                        "æ™šæ¥ç§‹ï¼Œå¤©å‡‰å¦‚æ°´ï¼Œæ—©ç‚¹ä¼‘æ¯å§ã€‚",
                        "æ™šä¸Šå¥½ï¼Œä»Šå¤©ä½ çœ‹åˆ°ç¾ä¸½çš„è½æ—¥äº†å—ï¼Ÿ",
                        "ç§‹å¤©çš„å¤œæ™šï¼Œæ€»è®©äººæ„Ÿè§‰æ ¼å¤–å®é™å’Œèˆ’é€‚ã€‚",
                        "å¤©æ°”è½¬å‡‰ï¼Œæ™šé¤è¦åƒå¾—æš–æš–å’Œå’Œçš„ã€‚",
                        "æœˆäº®æŒ‚åœ¨æå¤´ï¼Œåƒä¸€é¢—ç†Ÿé€çš„æœå­ã€‚æ™šå®‰ã€‚"
                    ],
                    night: [
                        "å¤œæ·±äº†ï¼Œç§‹æ„æ¸æµ“ï¼Œæ™šå®‰å¥½æ¢¦ã€‚ğŸŒ™",
                        "æ„¿ä½ ä¼´ç€çª—å¤–çš„æ¡‚èŠ±é¦™ï¼Œç”œç”œåœ°è¿›å…¥æ¢¦ä¹¡ã€‚",
                        "å¤©é˜¶å¤œè‰²å‡‰å¦‚æ°´ï¼Œå§çœ‹ç‰µç‰›ç»‡å¥³æ˜Ÿã€‚æ™šå®‰ã€‚",
                        "è¢«å­è¦ç›–åšä¸€ç‚¹äº†ï¼Œå¤œé‡Œä¼šé™æ¸©çš„ã€‚ğŸ˜´",
                        "å¤œæ·±äº†ï¼ŒæŠŠå¿ƒäº‹æ”¾ä¸€è¾¹ï¼Œå¥½å¥½ç¡è§‰æœ€é‡è¦ã€‚",
                        "æœ€èˆ’æœçš„äº‹ï¼Œè«è¿‡äºåœ¨å¾®å‡‰çš„ç§‹å¤œé‡Œç›–ç€æŸ”è½¯çš„è¢«å­ã€‚",
                        "æ™šå®‰ï¼Œæ„¿ä½ æ¢¦é‡Œæœ‰é‡‘è‰²çš„éº¦ç”°å’Œæœå®ã€‚",
                        "æ˜å¤©ä¼šæ›´å¥½ï¼Œå¿«ç¡å§ã€‚"
                    ]
                },
                winter: { // å†¬å­£ (12-2æœˆ)
                    morning: [
                        "æ—©ä¸Šå¥½ï¼Œè™½ç„¶å¤©æ°”å¯’å†·ï¼Œä½†ä¹Ÿè¦æ‹¥æŠ±é˜³å…‰å“¦ã€‚â„ï¸",
                        "æ—©å®‰ï¼Œå†¬å¤©æœ€å¹¸ç¦çš„äº‹ï¼Œå°±æ˜¯é†’æ¥æ—¶çª—å¤–æœ‰é˜³å…‰ã€‚",
                        "èµ·åºŠå¤§ä½œæˆ˜å¼€å§‹äº†ï¼ç¥ä½ æˆåŠŸï¼ğŸ’ª",
                        "å†¬æ—¥æ¸…æ™¨ï¼Œæ¥ä¸€æ¯çƒ­é¥®ï¼Œæ¸©æš–ä¸€æ•´å¤©ã€‚â˜•ï¸",
                        "æ—©å®‰ï¼ä»Šå¤©ä½ å’Œä½ çš„åºŠåˆ†ç¦»æˆåŠŸäº†å—ï¼Ÿ",
                        "çª—æˆ·ä¸Šç»“äº†éœœèŠ±ï¼Œå†¬å¤©çœŸçš„æ¥å•¦ã€‚â„ï¸",
                        "åƒä¸€é¡¿çƒ­æ°”è…¾è…¾çš„æ—©é¤ï¼Œæ˜¯å¯¹å†¬å¤©æ—©æ™¨æœ€å¤§çš„å°Šé‡ã€‚",
                        "å‘¼ä¸€å£æ°”éƒ½æ˜¯ç™½è‰²çš„ï¼Œè¿™æ‰æ˜¯å†¬å¤©çš„æ„Ÿè§‰ã€‚"
                    ],
                    afternoon: [
                        "ä¸‹åˆå¥½ï¼Œæ™’æ™’å†¬æ—¥çš„å¤ªé˜³ï¼Œæ•´ä¸ªäººéƒ½æš–æ´‹æ´‹çš„ã€‚",
                        "æ³¡ä¸ªçƒ­æ°´è„šï¼Œæ˜¯å¯¹å†¬å¤©ä¸‹åˆæœ€å¥½çš„å°Šé‡ã€‚",
                        "å¤©æ°”è¿™ä¹ˆå†·ï¼Œä¸å¦‚â€¦åƒé¡¿ç«é”…ï¼ŸğŸ²",
                        "åˆå®‰ï¼Œæ„¿è¿™ä¸ªå†¬å¤©ï¼Œæœ‰äººä¸ä½ ç«‹é»„æ˜ï¼Œæœ‰äººé—®ä½ ç²¥å¯æ¸©ã€‚",
                        "å†¬æ—¥çš„åˆåçŸ­æš‚åˆçè´µï¼Œå¤šæ™’æ™’å¤ªé˜³å§ã€‚",
                        "ä¸€æ¯çƒ­å¯å¯ï¼Œä¸€ä»½å¥½å¿ƒæƒ…ï¼Œé€ç»™è¿™ä¸ªä¸‹åˆçš„ä½ ã€‚â˜•ï¸",
                        "å¤–é¢å¤©å¯’åœ°å†»ï¼Œè¿˜æ˜¯å¾…åœ¨å®¤å†…æœ€èˆ’æœäº†ã€‚",
                        "ç¦»å¤©é»‘åˆè¿‘äº†ä¸€æ­¥ï¼Œçæƒœç™½å¤©çš„æ—¶å…‰ã€‚"
                    ],
                    evening: [
                        "æ™šä¸Šå¥½ï¼Œçª—å¤–å¤©å¯’åœ°å†»ï¼Œå±‹å†…æ¸©æš–å¦‚æ˜¥ã€‚",
                        "å†¬å¤©æœ€é€‚åˆçªåœ¨æ²™å‘é‡Œï¼Œçœ‹ä¸€éƒ¨æ¸©æš–çš„ç”µå½±ã€‚ğŸ¬",
                        "é›ªè½ä¸‹çš„å£°éŸ³ï¼Œæ˜¯å†¬å¤œçš„äº¤å“æ›²ã€‚",
                        "æ™šæ¥å¤©æ¬²é›ªï¼Œèƒ½é¥®ä¸€æ¯æ— ï¼Ÿ",
                        "æ™šä¸Šå¥½ï¼Œå›å®¶è·¯ä¸Šæ³¨æ„ä¿æš–å‘€ã€‚",
                        "å†¬å¤œçš„ç¯ç«ï¼Œçœ‹èµ·æ¥æ€»æ˜¯æ ¼å¤–æ¸©æš–ã€‚",
                        "å¿™äº†ä¸€å¤©ï¼Œçªåœ¨æ²™å‘é‡Œå°±æ˜¯æœ€å¤§çš„å¹¸ç¦ã€‚",
                        "å¤©å†·äº†ï¼Œä»Šæ™šåƒç‚¹çƒ­ä¹çš„å§ï¼"
                    ],
                    night: [
                        "å¤œæ·±äº†ï¼Œé’»è¿›æ¸©æš–çš„è¢«çªï¼Œå’Œä¸–ç•Œè¯´æ™šå®‰ã€‚ğŸ›Œ",
                        "æ™šå®‰ï¼Œæ„¿ä½ ä¸€å¤œæ— æ¢¦ï¼Œå®‰ç¡åˆ°å¤©äº®ã€‚",
                        "å†¬å¤©ï¼Œæ˜¯é€‚åˆæ—©ç¡çš„å­£èŠ‚ï¼Œæ™šå®‰ã€‚",
                        "è¯·æŸ¥æ”¶ä½ çš„å†¬æ—¥é™å®šå¥½æ¢¦ã€‚ğŸŒ™",
                        "æ™šå®‰ï¼Œè®©æ¸©æš–çš„è¢«çªæ²»æ„ˆä½ çš„ä¸€åˆ‡ã€‚",
                        "å¬ç€çª—å¤–çš„é£å£°ï¼Œå®‰ç¨³åœ°ç¡å§ã€‚",
                        "åˆ«ç†¬å¤œäº†ï¼Œå¯¹å¾—èµ·è¿™ä¹ˆå†·çš„å¤©å—ï¼Ÿå¿«å»ç¡è§‰ï¼",
                        "æ™šå®‰ï¼Œæ„¿ä½ æ¢¦é‡Œé˜³å…‰æ™®ç…§ï¼Œæ˜¥æš–èŠ±å¼€ã€‚"
                    ]
                },
                default: [ // é»˜è®¤/å¤‡ç”¨é—®å€™è¯­
                    "ä½ å¥½å‘€ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ",
                    "æ„¿ä½ çœ¼é‡Œçš„æ˜Ÿæ˜Ÿï¼Œæ°¸è¿œé—ªäº®ã€‚",
                    "æ— è®ºå¤©æ°”å¦‚ä½•ï¼Œè®°å¾—å¸¦ä¸Šè‡ªå·±çš„é˜³å…‰ã€‚",
                    "å¸Œæœ›ä½ ä»Šå¤©ä¹Ÿèƒ½å¼€å¿ƒï¼",
                    "å˜¿ï¼Œé™Œç”Ÿäººï¼Œç¥ä½ ä»Šå¤©å¼€å¿ƒã€‚",
                    "ç”Ÿæ´»æˆ–è®¸ä¸æ˜“ï¼Œä½†è¯·åˆ«å¿˜äº†å¾®ç¬‘ã€‚ğŸ˜Š",
                    "æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä»½ç‹¬ä¸€æ— äºŒçš„ç¤¼ç‰©ã€‚",
                    "å·å·å‘Šè¯‰ä½ ï¼Œä½ å¾ˆæ£’ï¼",
                    "æ„¿ä½ æ‰€åˆ°ä¹‹å¤„ï¼Œçš†ä¸ºçƒ­åœŸï¼›æ„¿ä½ æ‰€é‡ä¹‹äººï¼Œçš†ä¸ºè‰¯å–„ã€‚"
                ]
            };

            // åˆ¤æ–­å­£èŠ‚
            let season = 'default';
            if (month >= 3 && month <= 5) {
                season = 'spring';
            } else if (month >= 6 && month <= 8) {
                season = 'summer';
            } else if (month >= 9 && month <= 11) {
                season = 'autumn';
            } else { // 12, 1, 2æœˆ
                season = 'winter';
            }

            // åˆ¤æ–­æ—¶é—´æ®µ
            let timeOfDay = 'night';
            if (hour >= 5 && hour < 12) {
                timeOfDay = 'morning';
            } else if (hour >= 12 && hour < 18) {
                timeOfDay = 'afternoon';
            } else if (hour >= 18 && hour < 22) {
                timeOfDay = 'evening';
            }

            // è·å–å¯¹åº”çš„é—®å€™è¯­åˆ—è¡¨
            const availableGreetings = greetings[season][timeOfDay] || greetings.default;
            
            // éšæœºé€‰æ‹©ä¸€æ¡é—®å€™è¯­å¹¶æ˜¾ç¤º
            const randomGreeting = availableGreetings[Math.floor(Math.random() * availableGreetings.length)];
            greetingEl.textContent = randomGreeting;
        }

        // --- [REFACTORED] æ—¥å†è®¡ç®—æ ¸å¿ƒå‡½æ•° ---
        function lYearDays(y) { let i, sum = 348; for (i = 0x8000; i > 0x8; i >>= 1) sum += (lunarInfo[y - 1900] & i) ? 1 : 0; return (sum + leapDays(y)); }
        function leapDays(y) { if (leapMonth(y)) return ((lunarInfo[y - 1900] & 0x10000) ? 30 : 29); else return (0); }
        function leapMonth(y) { return (lunarInfo[y - 1900] & 0xf); }
        function monthDays(y, m) { return ((lunarInfo[y - 1900] & (0x10000 >> m)) ? 30 : 29); }
        function Dianaday(objDate) {
            const msPerDay = 86400000; // 24 * 60 * 60 * 1000
            const utcTarget = Date.UTC(objDate.getFullYear(), objDate.getMonth(), objDate.getDate());
            const utcBase = Date.UTC(1900, 0, 31);
            var offset = (utcTarget - utcBase) / msPerDay;

            var i, leap = 0, temp = 0;
            this.dayCyl = offset + 40; this.monCyl = 14; for (i = 1900; i < 2050 && offset > 0; i++) { temp = lYearDays(i); offset -= temp; this.monCyl += 12; } if (offset < 0) { offset += temp; i--; this.monCyl -= 12; } this.year = i; this.yearCyl = i - 1864; leap = leapMonth(i); this.isLeap = false; for (i = 1; i < 13 && offset > 0; i++) { if (leap > 0 && i == (leap + 1) && this.isLeap == false) { --i; this.isLeap = true; temp = leapDays(this.year); } else { temp = monthDays(this.year, i); } if (this.isLeap == true && i == (leap + 1)) this.isLeap = false; offset -= temp; if (this.isLeap == false) this.monCyl++; } if (offset == 0 && leap > 0 && i == leap + 1) if (this.isLeap) { this.isLeap = false; } else { this.isLeap = true; --i; --this.monCyl; } if (offset < 0) { offset += temp; --i; --this.monCyl; } this.month = i; this.day = offset + 1;
        }
        
        // --- [NEW] ä¸‰ä¼å¤©ç‰¹å®šæ—¥æœŸ ---
        // ç”±äºä¸‰ä¼å¤©è®¡ç®—å¤æ‚ä¸”ä¸åº•å±‚æ—¥å†æ•°æ®å¼ºç›¸å…³ï¼Œä¸ºä¿è¯å‡†ç¡®æ€§ï¼Œæ­¤å¤„ä½¿ç”¨é¢„å…ˆæŸ¥å®šçš„æ—¥æœŸ
        // æ•°æ®æ¥æºï¼šå…¬å¼€çš„å¤©æ–‡æ—¥å†ä¿¡æ¯
        const sanfuData = {
            2023: { rufu: '07-11', zhongfu: '07-21', mofu: '08-10' },
            2024: { rufu: '07-15', zhongfu: '07-25', mofu: '08-14' },
            2025: { rufu: '07-20', zhongfu: '07-30', mofu: '08-09' },
            2026: { rufu: '07-15', zhongfu: '07-25', mofu: '08-14' },
            2027: { rufu: '07-15', zhongfu: '07-25', mofu: '08-14' },
            2028: { rufu: '07-19', zhongfu: '07-29', mofu: '08-08' },
            2029: { rufu: '07-14', zhongfu: '07-24', mofu: '08-13' },
            2030: { rufu: '07-19', zhongfu: '07-29', mofu: '08-08' },
        };

        function getSanfuDates(year) {
            const dates = sanfuData[year];
            if (!dates) return [];
            
            const rufuDateParts = dates.rufu.split('-');
            const zhongfuDateParts = dates.zhongfu.split('-');
            const mofuDateParts = dates.mofu.split('-');

            return [
                { name: 'å…¥ä¼', date: new Date(year, parseInt(rufuDateParts[0]) - 1, parseInt(rufuDateParts[1])) },
                { name: 'ä¸­ä¼', date: new Date(year, parseInt(zhongfuDateParts[0]) - 1, parseInt(zhongfuDateParts[1])) },
                { name: 'æœ«ä¼', date: new Date(year, parseInt(mofuDateParts[0]) - 1, parseInt(mofuDateParts[1])) }
            ];
        }
        
        function getAllHolidaysForYear(year) {
            let allEvents = [];
            
            function getSolarDateForLunar(targetYear, lunarMonth, lunarDay) {
                for (let i = 0; i < 366; i++) {
                    const checkDate = new Date(targetYear, 0, 1);
                    checkDate.setDate(checkDate.getDate() + i);
                    if (checkDate.getFullYear() !== targetYear) break;
                    const lunarDateInfo = new Dianaday(checkDate);
                    if (lunarDateInfo.month === lunarMonth && lunarDateInfo.day === lunarDay && !lunarDateInfo.isLeap) return checkDate;
                }
                return null;
            }

            // å…¬å†èŠ‚æ—¥
            sFtv.forEach(holiday => {
                if (holiday.start && year < holiday.start) {
                    return;
                }
                const month = parseInt(holiday.date.substr(0, 2));
                const day = parseInt(holiday.date.substr(2, 2));
                allEvents.push({ name: holiday.name, date: new Date(year, month - 1, day) });
            });

            // å†œå†èŠ‚æ—¥
            const allLunarHolidays = [...lFtv, { date: "1230", name: "é™¤å¤•" }];
            allLunarHolidays.forEach(holiday => {
                const name = holiday.name;
                if (name === 'é™¤å¤•') {
                    // To find the New Year's Eve that falls within a given Gregorian year, we find the
                    // Spring Festival of that same year and calculate the day before it.
                    const cnyDate = getSolarDateForLunar(year, 1, 1);
                    if (cnyDate) {
                        let eveDate = new Date(cnyDate);
                        eveDate.setDate(eveDate.getDate() - 1);
                        // Only add it if the calculated Eve date actually falls in the target year.
                        if (eveDate.getFullYear() === year) {
                            allEvents.push({ name: 'é™¤å¤•', date: eveDate });
                        }
                    }
                } else {
                    const lMonth = parseInt(holiday.date.substr(0, 2));
                    const lDay = parseInt(holiday.date.substr(2, 2));
                    const holidayDate = getSolarDateForLunar(year, lMonth, lDay);
                    if (holidayDate) allEvents.push({ name: holiday.name, date: holidayDate });
                }
            });

            // èŠ‚æ°”
            solarTerm.forEach((termName, i) => {
                const offDate = new Date((31556925974.7 * (year - 1900) + sTermInfo[i] * 60000) + Date.UTC(1900, 0, 6, 2, 5));
                allEvents.push({ name: termName, date: new Date(offDate.getUTCFullYear(), offDate.getUTCMonth(), offDate.getUTCDate()) });
            });

            // å‘¨æ—¥è®¡ç®—çš„èŠ‚æ—¥
            const mayFirst = new Date(year, 4, 1);
            const mothersDay = new Date(year, 4, 1 + (7 - mayFirst.getDay() + 7) % 7 + 7);
            allEvents.push({ name: 'æ¯äº²èŠ‚', date: mothersDay });

            const juneFirst = new Date(year, 5, 1);
            const fathersDay = new Date(year, 5, 1 + (7 - juneFirst.getDay() + 7) % 7 + 14);
            allEvents.push({ name: 'çˆ¶äº²èŠ‚', date: fathersDay });

            const novFirst = new Date(year, 10, 1);
            const thanksgivingDay = new Date(year, 10, 1 + (4 - novFirst.getDay() + 7) % 7 + 21);
            allEvents.push({ name: 'æ„Ÿæ©èŠ‚', date: thanksgivingDay });
            
            // æ·»åŠ ä¸‰ä¼å¤©
            const sanfuDates = getSanfuDates(year);
            allEvents.push(...sanfuDates);

            // æ’åºå¹¶è¿”å›
            return allEvents.sort((a, b) => a.date - b.date);
        }

        // --- ä¸»å€’è®¡æ—¶å¡ç‰‡æ›´æ–° ---
        function updateCountdown() {
            const countdownDisplay = document.getElementById('countdown-display');
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            const currentYearEvents = getAllHolidaysForYear(now.getFullYear());
            const nextYearEvents = getAllHolidaysForYear(now.getFullYear() + 1);

            const upcomingEvents = [...currentYearEvents, ...nextYearEvents].filter(event => event.date >= today);

            if (upcomingEvents.length > 0) {
                const nextHoliday = upcomingEvents[0];
                const diffTime = nextHoliday.date - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 0) {
                    countdownDisplay.innerHTML = `<span class="text-lg" style="color: var(--text-color-primary);">ä»Šå¤©</span><br><strong class="text-3xl font-bold" style="color: var(--accent-color);">${nextHoliday.name}</strong>`;
                } else if (diffDays === 1) {
                    countdownDisplay.innerHTML = `<span class="text-lg" style="color: var(--text-color-primary);">æ˜å¤©</span><br><strong class="text-3xl font-bold" style="color: var(--accent-color);">${nextHoliday.name}</strong>`;
                } else {
                    countdownDisplay.innerHTML = `<span style="color: var(--text-color-primary);">è·ç¦»</span><br><strong class="text-xl" style="color: var(--text-color-primary);">${nextHoliday.name}</strong><br><span class="font-bold text-5xl align-baseline">${diffDays}</span><span class="text-lg align-baseline ml-1">å¤©</span>`;
                }
            } else {
                countdownDisplay.textContent = 'æ‰€æœ‰èŠ‚æ—¥éƒ½å·²è®¡ç®—å®Œæ¯•ï¼';
            }
        }

        // --- èŠ‚æ—¥åˆ—è¡¨è§†å›¾æ›´æ–° ---
        function displayHolidayList(year, isAnimated = false) {
            const container = document.getElementById('holiday-list-container');
            const yearDisplay = document.getElementById('holiday-list-year');

            const updateContent = () => {
                yearDisplay.textContent = year;
            
                const allHolidays = getAllHolidaysForYear(year);
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

                const firstUpcoming = [...getAllHolidaysForYear(now.getFullYear()), ...getAllHolidaysForYear(now.getFullYear() + 1)]
                    .filter(e => e.date >= today)[0];

                const holidaysByMonth = allHolidays.reduce((acc, holiday) => {
                    const month = holiday.date.getMonth();
                    if (!acc[month]) acc[month] = [];
                    acc[month].push(holiday);
                    return acc;
                }, {});

                let html = '';
                for (let month = 0; month < 12; month++) {
                    if (holidaysByMonth[month]) {
                        html += `<div class="mb-3"><h3 class="text-lg font-semibold border-b pb-1 mb-2" style="color: var(--text-color-secondary); border-color: var(--separator-color);">${month + 1}æœˆ</h3>`;
                        holidaysByMonth[month].forEach(holiday => {
                            const diffTime = holiday.date - today;
                            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                            let statusText = '';
                            if (holiday.date.getFullYear() < now.getFullYear() || (holiday.date.getFullYear() === now.getFullYear() && diffDays < -1)) {
                                statusText = `<span style="color: var(--status-past);">å·²è¿‡</span>`;
                            } else if (diffDays === -1) {
                                statusText = `<span style="color: var(--status-yesterday);">æ˜¨å¤©</span>`;
                            } else if (diffDays === 0) {
                                statusText = `<span style="color: var(--status-today); font-weight: bold;">ä»Šå¤©</span>`;
                            } else if (diffDays === 1) {
                                statusText = `<span style="color: var(--status-tomorrow); font-weight: bold;">æ˜å¤©</span>`;
                            } else {
                                statusText = `<span style="color: var(--accent-color);">${diffDays} å¤©</span>`;
                            }
                            
                            const isHighlighted = firstUpcoming && firstUpcoming.name === holiday.name && firstUpcoming.date.getTime() === holiday.date.getTime();
                            const highlightClass = isHighlighted ? 'highlight-holiday' : '';

                            html += `
                                <div class="flex justify-between items-center p-2 rounded-lg ${highlightClass}">
                                    <div>
                                        <span style="color: var(--text-color-primary);">${holiday.name}</span>
                                        <span class="text-xs ml-2" style="color: var(--text-color-secondary);">${String(holiday.date.getMonth() + 1).padStart(2, '0')}-${String(holiday.date.getDate()).padStart(2, '0')}</span>
                                    </div>
                                    ${statusText}
                                </div>
                            `;
                        });
                        html += `</div>`;
                    }
                }
                container.innerHTML = html;
                // [NEW] Update button visibility after content is rendered
                setTimeout(updateTodayButtonVisibility, 50);
            };

            if (isAnimated) {
                container.style.opacity = 0;
                yearDisplay.style.opacity = 0;
                setTimeout(() => {
                    updateContent();
                    container.style.opacity = 1;
                    yearDisplay.style.opacity = 1;
                }, 100);
            } else {
                updateContent();
            }
        }

        // [NEW] Custom smooth scroll implementation for speed control
        function customSmoothScrollTo(targetElement, options) {
            const { duration = 300, block = 'center' } = options;
            // SimpleBar creates a specific wrapper for the scrollable content.
            const scrollContainer = document.getElementById('holiday-list-container-wrapper').querySelector('.simplebar-content-wrapper');

            if (!scrollContainer || !targetElement) return;

            let targetY;
            if (block === 'center') {
                targetY = targetElement.offsetTop + (targetElement.offsetHeight / 2) - (scrollContainer.offsetHeight / 2);
            } else if (block === 'start') {
                targetY = targetElement.offsetTop;
            } else { // 'end'
                targetY = targetElement.offsetTop + targetElement.offsetHeight - scrollContainer.offsetHeight;
            }
            
            // Ensure targetY is within scrollable bounds
            targetY = Math.max(0, Math.min(targetY, scrollContainer.scrollHeight - scrollContainer.clientHeight));

            const startY = scrollContainer.scrollTop;
            const distance = targetY - startY;
            let startTime = null;

            // easeInOutCubic easing function for a slightly smoother start/end
            function ease(t, b, c, d) {
                t /= d / 2;
                if (t < 1) return c / 2 * t * t * t + b;
                t -= 2;
                return c / 2 * (t * t * t + 2) + b;
            }

            function animation(currentTime) {
                if (startTime === null) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const run = ease(timeElapsed, startY, distance, duration);
                scrollContainer.scrollTop = run;
                if (timeElapsed < duration) {
                    requestAnimationFrame(animation);
                }
            }

            requestAnimationFrame(animation);
        }

        // [NEW] Core function to scroll to the target festival
        const scrollToTargetFestival = (isAnimated = true) => {
            // Use a timeout to ensure the DOM has updated, e.g., after a year change
            setTimeout(() => {
                const container = document.getElementById('holiday-list-container');
                if (!container) return;

                let targetElement = container.querySelector('.highlight-holiday');

                // If no highlighted holiday in the current view (e.g., all passed for the year)
                if (!targetElement) {
                    // As per user request, find the last festival of the displayed year
                    const allHolidays = container.querySelectorAll('.flex.justify-between.items-center');
                    if (allHolidays.length > 0) {
                        targetElement = allHolidays[allHolidays.length - 1];
                    }
                }

                if (targetElement) {
                    if (isAnimated) {
                        customSmoothScrollTo(targetElement, { duration: 300, block: 'center' });
                    } else {
                        targetElement.scrollIntoView({ behavior: 'auto', block: 'center' });
                    }
                }
            }, 160); // Must be slightly longer than the list update animation (150ms)
        };

        // [NEW] Logic for the "Today" button's visibility
        let todayButtonObserver;
        function updateTodayButtonVisibility() {
            const backToTodayBtn = document.getElementById('back-to-today-btn');
            const currentYear = new Date().getFullYear();

            if (todayButtonObserver) {
                todayButtonObserver.disconnect();
            }

            if (holidayListDisplayedYear !== currentYear) {
                backToTodayBtn.classList.add('visible'); // Always show for other years
                return;
            }

            // Logic for the current year
            const container = document.getElementById('holiday-list-container');
            let targetElement = container.querySelector('.highlight-holiday');

            if (!targetElement) {
                const allHolidays = container.querySelectorAll('.flex.justify-between.items-center');
                if (allHolidays.length > 0) {
                    targetElement = allHolidays[allHolidays.length - 1];
                }
            }

            if (targetElement) {
                const scrollWrapper = document.getElementById('holiday-list-container-wrapper');
                todayButtonObserver = new IntersectionObserver((entries) => {
                    const [entry] = entries;
                    // Show button if target is NOT visible
                    if (entry.isIntersecting) {
                        backToTodayBtn.classList.remove('visible');
                    } else {
                        backToTodayBtn.classList.add('visible');
                    }
                }, {
                    root: scrollWrapper,
                    threshold: 0.5 // 50% of the element is visible
                });
                todayButtonObserver.observe(targetElement);
            } else {
                // No target element found, hide the button
                backToTodayBtn.classList.remove('visible');
            }
        }

        // --- Hitokoto ä¸€è¨€ åŠŸèƒ½ ---
        let isUpdatingQuote = false;
        async function fetchHitokoto() {
            if (isUpdatingQuote) return;
            isUpdatingQuote = true;
            const hitokotoText = document.getElementById('hitokoto-text');
            const hitokotoFrom = document.getElementById('hitokoto-from');
            hitokotoText.classList.add('opacity-0');
            hitokotoFrom.classList.add('opacity-0');
            try {
                await new Promise(resolve => setTimeout(resolve, 500));
                const response = await fetch('https://v1.hitokoto.cn/?encode=json');
                if (!response.ok) throw new Error('Network response was not ok.');
                const data = await response.json();
                hitokotoText.textContent = data.hitokoto;
                hitokotoFrom.textContent = `â€” ã€Œ${data.from || 'æœªçŸ¥æ¥æº'}ã€`;
            } catch (error) {
                console.error("è·å–ä¸€è¨€å¤±è´¥:", error);
                hitokotoText.textContent = 'è·å–ä¸€è¨€å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚';
                hitokotoFrom.textContent = '';
            } finally {
                hitokotoText.classList.remove('opacity-0');
                hitokotoFrom.classList.remove('opacity-0');
                setTimeout(() => { isUpdatingQuote = false; }, 600);
            }
        }

        // --- æ—¶å…‰èƒ¶å›ŠåŠŸèƒ½ ---
        function updateTimeCapsule() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const dayOfMonth = now.getDate();
            const dayOfWeek = now.getDay(); // 0 for Sunday, 1 for Monday, etc.
            const hour = now.getHours();

            // 1. ä»Šæ—¥è¿›åº¦
            const dayPassed = hour;
            const dayLeft = 24 - dayPassed;
            const dayPercent = (dayPassed / 24) * 100;
            document.getElementById('day-passed').textContent = dayPassed;
            document.getElementById('day-left').textContent = dayLeft;
            document.getElementById('day-percent').textContent = `${dayPercent.toFixed(1)}%`;
            document.getElementById('day-progress').style.width = `${dayPercent}%`;

            // 2. æœ¬å‘¨è¿›åº¦ (å‘¨ä¸€ä¸ºç¬¬ä¸€å¤©)
            const weekPassed = dayOfWeek === 0 ? 7 : dayOfWeek;
            const weekLeft = 7 - weekPassed;
            const weekPercent = (weekPassed / 7) * 100;
            document.getElementById('week-passed').textContent = weekPassed;
            document.getElementById('week-left').textContent = weekLeft;
            document.getElementById('week-percent').textContent = `${weekPercent.toFixed(1)}%`;
            document.getElementById('week-progress').style.width = `${weekPercent}%`;

            // 3. æœ¬æœˆè¿›åº¦
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const monthPassed = dayOfMonth;
            const monthLeft = daysInMonth - monthPassed;
            const monthPercent = (monthPassed / daysInMonth) * 100;
            document.getElementById('month-passed').textContent = monthPassed;
            document.getElementById('month-left').textContent = monthLeft;
            document.getElementById('month-percent').textContent = `${monthPercent.toFixed(1)}%`;
            document.getElementById('month-progress').style.width = `${monthPercent}%`;

            // 4. ä»Šå¹´è¿›åº¦
            const startOfYear = new Date(year, 0, 1);
            const endOfYear = new Date(year, 11, 31);
            const totalDaysInYear = (endOfYear - startOfYear) / (1000 * 60 * 60 * 24) + 1;
            const yearPassed = Math.ceil((now - startOfYear) / (1000 * 60 * 60 * 24));
            const yearLeft = totalDaysInYear - yearPassed;
            const yearPercent = (yearPassed / totalDaysInYear) * 100;
            document.getElementById('year-passed').textContent = yearPassed;
            document.getElementById('year-left').textContent = yearLeft;
            document.getElementById('year-percent').textContent = `${yearPercent.toFixed(1)}%`;
            document.getElementById('year-progress').style.width = `${yearPercent}%`;
        }
        
        // --- ç½‘ç«™è¿è¡Œæ—¶é—´ ---
        function updateSiteRuntime() {
             const startTime = new Date('2025-07-30T18:30:00');
            const now = new Date();
            const diff = now - startTime;

            const displayElement = document.getElementById('site-runtime-display');
            if (!displayElement) return;

            if (diff < 0) {
                displayElement.textContent = 'å°ç ´ç«™å°šæœªå¯èˆª...';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            displayElement.innerHTML = `å°ç ´ç«™å·²ç»åœ¨é£é›¨ä¸­åº¦è¿‡äº† <span class="font-semibold runtime-number" style="color: var(--text-color-primary);">${days}</span> å¤© <span class="font-semibold runtime-number" style="color: var(--text-color-primary);">${hours}</span> å°æ—¶ <span class="font-semibold runtime-number" style="color: var(--text-color-primary);">${minutes}</span> åˆ† <span class="font-semibold runtime-number" style="color: var(--text-color-primary);">${seconds}</span> ç§’`;
        }

        // --- GitHub Chart Loader Logic ---
        function setupGitHubChartLoader() {
            const loader = document.getElementById('gh-chart-loader');
            const errorContainer = document.getElementById('gh-chart-error');
            const errorMessage = document.getElementById('gh-chart-error-message');
            const imgLink = document.getElementById('gh-chart-link');
            const img = document.getElementById('gh-chart-img');

            const loadImage = () => {
                // Show loader, hide error
                loader.style.display = 'flex';
                errorContainer.classList.add('hidden');
                errorContainer.classList.remove('flex');

                const originalSrc = img.dataset.src;
                const baseUrl = originalSrc.split('?')[0];
                // Reconstruct URL to safely add cache-busting parameter
                img.src = `${baseUrl}?theme=dark&v=${new Date().getTime()}`;
            };

            img.onload = () => {
                loader.style.display = 'none';
                imgLink.classList.remove('invisible');
                imgLink.classList.add('visible');
                img.classList.add('loaded');
            };

            img.onerror = () => {
                loader.style.display = 'none';
                errorContainer.classList.remove('hidden');
                errorContainer.classList.add('flex');
                errorMessage.textContent = 'è´¡çŒ®å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå¹¶é‡è¯•ã€‚';
            };

            errorContainer.addEventListener('click', () => {
                loadImage();
            });

            // Initial load
            loadImage();
        }

        // --- [NEW] Settings Panel UI Generation ---
        function setupSettingsUI() {
            // --- 1. Background Settings ---
            const bgSettingsContainer = document.getElementById('background-settings-content');
            if (bgSettingsContainer) {
                const bgOptions = [
                    { value: 'default', label: 'é»˜è®¤å›¾ç‰‡' },
                    { value: 'bing', label: 'æ¯æ—¥ä¸€Bing' },
                    { value: 'anime', label: 'éšæœºåŠ¨æ¼«' },
                    { value: 'random', label: 'éšæœºå›¾ç‰‡' }
                ];

                let bgSettingsHTML = '';
                bgOptions.forEach(option => {
                    bgSettingsHTML += `
                        <div>
                            <input type="radio" id="bg-radio-${option.value}" name="background-source" value="${option.value}" class="setting-radio-input">
                            <label for="bg-radio-${option.value}" class="setting-radio-label">
                                <span class="custom-radio-button"></span>
                                <span>${option.label}</span>
                            </label>
                        </div>
                    `;
                });
                
                let defaultOptionsHTML = `
                    <div id="default-bg-options">
                        <div class="thumb-container">
                            <div class="thumb-item" data-bg-url="random">
                                <div class="thumb-overlay">éšæœº</div>
                            </div>
                `;
                DEFAULT_BG_IMAGES.forEach((url, index) => {
                    defaultOptionsHTML += `
                        <div class="thumb-item" data-bg-url="${url}">
                            <img src="${url}" alt="Default Background ${index + 1}" loading="lazy">
                        </div>
                    `;
                });
                defaultOptionsHTML += `</div></div>`;

                bgSettingsContainer.innerHTML = bgSettingsHTML + defaultOptionsHTML;
            }
        }

        // --- [NEW] Settings Management ---
        let appSettings = {
            background: {
                source: 'default',
                specifier: 'random'
            },
            theme: 'system', // 'system', 'light', 'dark'
            view: 'github',
            weather: {
                city: null, // User-overridden city
                lastFetchedCity: null // City from last successful fetch
            }
        };

        const WEATHER_TIPS = {
            sunny: ["é˜³å…‰æ˜åªšï¼Œé€‚åˆå‡ºé—¨æ•£æ­¥ã€‚", "å¤©æ°”æ™´æœ—ï¼Œå¿ƒæƒ…ä¹Ÿè·Ÿç€é˜³å…‰èµ·æ¥ï¼", "ä»Šå¤©ç´«å¤–çº¿å¯èƒ½è¾ƒå¼ºï¼Œæ³¨æ„é˜²æ™’å“¦ã€‚"],
            rain: ["ä¸‹é›¨äº†ï¼Œå‡ºé—¨åˆ«å¿˜äº†å¸¦ä¼ã€‚", "é›¨å¤©è·¯æ»‘ï¼Œå‡ºè¡Œè¯·æ³¨æ„å®‰å…¨ã€‚", "ç»†é›¨è’™è’™ï¼Œæœ€é€‚åˆå¬éŸ³ä¹ã€è¯»æœ¬ä¹¦ã€‚"],
            snow: ["ä¸‹é›ªå•¦ï¼æ³¨æ„ä¿æš–ï¼Œå°å¿ƒåœ°æ»‘ã€‚", "ç‘é›ªå…†ä¸°å¹´ï¼Œå†¬å¤©å¿«ä¹ï¼", "é›ªå¤©è·¯å†µå¤æ‚ï¼Œè¯·è°¨æ…é©¾é©¶ã€‚"],
            cloudy: ["è™½ç„¶æ˜¯å¤šäº‘ï¼Œä½†ä¹Ÿè¦ä¿æŒå¥½å¿ƒæƒ…ã€‚", "äº‘å±‚ç¨åšï¼Œä½†å¶å°”ä¹Ÿä¼šæœ‰é˜³å…‰ã€‚", "é˜´å¤©ï¼Œæ˜¯é€‚åˆæ€å¿µå’Œæ”¾ç©ºçš„å¤©æ°”ã€‚"],
            overcast: ["å¤©ç©ºé˜´æ²‰æ²‰çš„ï¼Œä½†åˆ«è®©å®ƒå½±å“ä½ çš„å¥½å¿ƒæƒ…ã€‚", "é˜´å¤©ï¼Œé€‚åˆé™ä¸‹å¿ƒæ¥ï¼Œäº«å—å®é™ã€‚", "ä»Šå¤©å¯èƒ½çœ‹ä¸åˆ°è“å¤©ç™½äº‘äº†ï¼Œä½†æœ‰å¦ä¸€ç•ªæ™¯è‡´ã€‚"],
            hot: ["å¤©æ°”ç‚çƒ­ï¼Œæ³¨æ„é˜²æš‘é™æ¸©ï¼Œå¤šå–æ°´ã€‚", "çƒ­æµªæ¥è¢­ï¼Œå°½é‡é¿å…åˆåé•¿æ—¶é—´æˆ·å¤–æ´»åŠ¨ã€‚", "å¿ƒé™è‡ªç„¶å‡‰ï¼Œä½†ç©ºè°ƒä¹Ÿè®¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚"],
            cold: ["å¤©æ°”è½¬å†·ï¼ŒåŠæ—¶å¢æ·»è¡£ç‰©ï¼Œè°¨é˜²æ„Ÿå†’ã€‚", "å¯’é£å‡›å†½ï¼Œå–æ¯çƒ­èŒ¶æš–æš–èº«å­å§ã€‚", "å†¬å¤©åˆ°å•¦ï¼Œä¿æš–æ˜¯ç¬¬ä¸€è¦åŠ¡ã€‚"],
            windy: ["ä»Šå¤©é£æœ‰ç‚¹å¤§ï¼Œå‡ºé—¨æˆ´å¥½å¸½å­ï¼Œå°å¿ƒå‘å‹ã€‚", "é£å¤§çš„æ—¥å­ï¼Œé€‚åˆåœ¨å®¤å†…æ„Ÿå—å®‰é€¸ã€‚", "å¬ï¼Œé£åœ¨å”±æ­Œã€‚"],
            fog: ["å¤§é›¾å¼¥æ¼«ï¼Œèƒ½è§åº¦ä½ï¼Œå‡ºè¡Œæ³¨æ„å®‰å…¨ã€‚", "é›¾å¤©å¼€è½¦ï¼Œè¯·å‡é€Ÿæ…¢è¡Œï¼Œä¿æŒè½¦è·ã€‚", "ä»Šå¤©çš„ä¸–ç•Œï¼Œä»¿ä½›åŠ äº†ä¸€å±‚æœ¦èƒ§æ»¤é•œã€‚"],
            default: ["æ„¿ä½ çœ¼é‡Œçš„æ˜Ÿæ˜Ÿï¼Œæ°¸è¿œé—ªäº®ã€‚", "ç”Ÿæ´»æˆ–è®¸ä¸æ˜“ï¼Œä½†è¯·åˆ«å¿˜äº†å¾®ç¬‘ã€‚ğŸ˜Š", "æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä»½ç‹¬ä¸€ç„¡äºŒçš„ç¤¼ç‰©ã€‚"]
        };

        function getWeatherTip(current, forecast) {
            const tempC = parseInt(current.temp_C);
            const weatherDesc = current.weatherDesc[0].value.toLowerCase();
            const month = new Date().getMonth() + 1; // 1-12
            const isWinter = month === 12 || month === 1 || month === 2;

            if (tempC > 30) return WEATHER_TIPS.hot[Math.floor(Math.random() * WEATHER_TIPS.hot.length)];
            if (tempC < 5) return WEATHER_TIPS.cold[Math.floor(Math.random() * WEATHER_TIPS.cold.length)];

            if (weatherDesc.includes('rain') || weatherDesc.includes('shower')) return WEATHER_TIPS.rain[Math.floor(Math.random() * WEATHER_TIPS.rain.length)];
            if (weatherDesc.includes('snow') || weatherDesc.includes('sleet') || weatherDesc.includes('blizzard')) return WEATHER_TIPS.snow[Math.floor(Math.random() * WEATHER_TIPS.snow.length)];
            
            if ((weatherDesc.includes('sunny') || weatherDesc.includes('clear')) && !isWinter) {
                 return WEATHER_TIPS.sunny[Math.floor(Math.random() * WEATHER_TIPS.sunny.length)];
            } else if (weatherDesc.includes('sunny') || weatherDesc.includes('clear')) {
                return "å†¬æ—¥æš–é˜³ï¼Œéš¾å¾—çš„å¥½å¤©æ°”ï¼";
            }

            if (weatherDesc.includes('overcast')) return WEATHER_TIPS.overcast[Math.floor(Math.random() * WEATHER_TIPS.overcast.length)];
            if (weatherDesc.includes('cloudy') || weatherDesc.includes('mist')) return WEATHER_TIPS.cloudy[Math.floor(Math.random() * WEATHER_TIPS.cloudy.length)];
            if (parseInt(current.windspeedKmph) > 30) return WEATHER_TIPS.windy[Math.floor(Math.random() * WEATHER_TIPS.windy.length)];
            if (weatherDesc.includes('fog')) return WEATHER_TIPS.fog[Math.floor(Math.random() * WEATHER_TIPS.fog.length)];

            return WEATHER_TIPS.default[Math.floor(Math.random() * WEATHER_TIPS.default.length)];
        }


        // --- [NEW] Weather Fetching Logic ---
        async function fetchAndDisplayWeather() {
            const weatherWrapper = document.getElementById('weather-content-wrapper');
            weatherWrapper.innerHTML = `<p style="color: var(--text-color-secondary);">æ­£åœ¨è·å–å¤©æ°”...</p>`;

            let location = appSettings.weather.city;

            if (!location) {
                try {
                    const ipResponse = await fetch('https://ipapi.co/json/');
                    if (!ipResponse.ok) throw new Error('IP API request failed');
                    const ipData = await ipResponse.json();
                    location = ipData.city || 'auto:ip';
                } catch (e) {
                    console.error("IP-based geolocation failed.", e);
                    weatherWrapper.innerHTML = `<p style="color: var(--accent-color);">æ— æ³•è‡ªåŠ¨ç¡®å®šæ‚¨çš„ä½ç½®</p><p class="text-xs mt-2" style="color: var(--text-color-tertiary);">è¯·åœ¨è®¾ç½®ä¸­æ‰‹åŠ¨è¾“å…¥åŸå¸‚ã€‚</p>`;
                    return;
                }
            }

            try {
                const weatherResponse = await fetch(`https://wttr.in/${encodeURIComponent(location)}?format=j1`);
                if (!weatherResponse.ok) throw new Error(`Weather data not found for ${location}`);
                const data = await weatherResponse.json();
                
                const current = data.current_condition[0];
                const forecast = data.weather[0];
                const nearestArea = data.nearest_area[0];
                
                appSettings.weather.lastFetchedCity = `${nearestArea.areaName[0].value}, ${nearestArea.country[0].value}`;
                saveSettings();
                
                const tip = getWeatherTip(current, forecast);

                // --- Render HTML ---
                weatherWrapper.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-2xl font-bold" style="color: var(--text-color-primary);">${current.temp_C}Â°C</p>
                            <p class="text-sm" style="color: var(--text-color-secondary);">${current.weatherDesc[0].value}, ä½“æ„Ÿ ${current.FeelsLikeC}Â°C</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold" style="color: var(--text-color-primary);">${nearestArea.areaName[0].value}</p>
                            <p class="text-xs" style="color: var(--text-color-secondary);">${nearestArea.country[0].value}</p>
                        </div>
                    </div>
                    <div class="mt-4 text-sm space-y-2">
                        <div class="flex justify-between">
                            <span style="color: var(--text-color-secondary);">æœ€é«˜/æœ€ä½</span>
                            <span style="color: var(--text-color-primary);">${forecast.maxtempC}Â°C / ${forecast.mintempC}Â°C</span>
                        </div>
                        <div class="flex justify-between">
                            <span style="color: var(--text-color-secondary);">é£é€Ÿ</span>
                            <span style="color: var(--text-color-primary);">${current.windspeedKmph} km/h</span>
                        </div>
                        <div class="flex justify-between">
                            <span style="color: var(--text-color-secondary);">æ¹¿åº¦</span>
                            <span style="color: var(--text-color-primary);">${current.humidity}%</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 text-center text-xs" style="border-top: 1px solid var(--separator-color); color: var(--text-color-tertiary);">
                        ${tip}
                    </div>
                `;
                
                updateSettingsUI(); // Update UI with new city name if it was auto-detected
            } catch (e) {
                console.error("Failed to fetch weather data.", e);
                weatherWrapper.innerHTML = `<p style="color: var(--accent-color);">æ— æ³•åŠ è½½ "${location}" çš„å¤©æ°”ä¿¡æ¯ã€‚</p><p class="text-xs mt-2" style="color: var(--text-color-tertiary);">è¯·æ£€æŸ¥åŸå¸‚åç§°æˆ–ç½‘ç»œè¿æ¥ã€‚</p>`;
                appSettings.weather.lastFetchedCity = 'åŠ è½½å¤±è´¥';
                updateSettingsUI();
            }
        }


        function saveSettings() {
            localStorage.setItem('qing-homepage-settings', JSON.stringify(appSettings));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('qing-homepage-settings');
            if (savedSettings) {
                try {
                    const parsedSettings = JSON.parse(savedSettings);
                    // Merge saved settings with defaults to ensure compatibility with future updates
                    appSettings = {
                        ...appSettings,
                        ...parsedSettings,
                        background: { ...appSettings.background, ...parsedSettings.background },
                    };
                } catch (e) {
                    console.error("Failed to parse settings from localStorage", e);
                    // If parsing fails, use default settings
                }
            }
        }
        
        async function applyCurrentBackground() {
            const { source, specifier } = appSettings.background;
            let imageUrl = '';
            const bgContainer = document.getElementById('bg-container');
        
            // This function replaces the old `setRandomBackground`
            // It directly uses the settings state.
            const showImage = (url) => {
                const img = new Image();
                img.src = url;
                img.onload = () => {
                    bgContainer.style.backgroundImage = `url('${url}')`;
                    bgContainer.style.opacity = 1;
                };
                img.onerror = () => {
                    console.error(`Failed to load image: ${url}. Falling back to default.`);
                    // Fallback to a truly random default image on error
                    const randomFallbackUrl = DEFAULT_BG_IMAGES[Math.floor(Math.random() * DEFAULT_BG_IMAGES.length)];
                    showImage(randomFallbackUrl);
                };
            };

            bgContainer.style.opacity = 0; // Fade out before loading new image

            try {
                switch (source) {
                    case 'bing':
                        // Using a CORS proxy for client-side reliability
                        const bingResponse = await fetch('https://cors.eu.org/https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=zh-CN');
                        if (!bingResponse.ok) throw new Error('Bing API request failed');
                        const bingData = await bingResponse.json();
                        imageUrl = `https://www.bing.com${bingData.images[0].url}`;
                        break;
                    case 'anime':
                        // Add a timestamp to prevent caching
                        imageUrl = 'https://api.sretna.cn/api/anime.php';
                        break;
                    case 'random':
                        imageUrl = 'https://imgapi.cn/api.php?zd=zsy&fl=fengjing&gs=images';
                        break;
                    case 'default':
                    default:
                        if (specifier && specifier !== 'random' && DEFAULT_BG_IMAGES.includes(specifier)) {
                            imageUrl = specifier;
                        } else {
                            imageUrl = DEFAULT_BG_IMAGES[Math.floor(Math.random() * DEFAULT_BG_IMAGES.length)];
                        }
                        break;
                }
                showImage(imageUrl);
            } catch (error) {
                console.error(`Error fetching background from source: ${source}`, error);
                // Fallback to a random default image on any error
                const randomFallbackUrl = DEFAULT_BG_IMAGES[Math.floor(Math.random() * DEFAULT_BG_IMAGES.length)];
                showImage(randomFallbackUrl);
            }
        }

        function updateBgSettingsUI() {
            const { source, specifier } = appSettings.background;

            // Update radio buttons
            const radio = document.querySelector(`input[name="background-source"][value="${source}"]`);
            if (radio) {
                radio.checked = true;
            }

            // Update thumbnail selection
            const defaultOptionsContainer = document.getElementById('default-bg-options');
            const allThumbs = defaultOptionsContainer.querySelectorAll('.thumb-item');
            allThumbs.forEach(thumb => thumb.classList.remove('active'));
            
            const activeThumb = defaultOptionsContainer.querySelector(`.thumb-item[data-bg-url="${specifier}"]`);
            if (activeThumb) {
                activeThumb.classList.add('active');
            }

            // Show/hide thumbnail section
            if (source === 'default') {
                defaultOptionsContainer.classList.add('open');
            } else {
                defaultOptionsContainer.classList.remove('open');
            }
        }

        function updateThemeSettingsUI() {
            const currentTheme = appSettings.theme;
            document.querySelectorAll('.setting-btn-group .setting-btn').forEach(btn => {
                if (btn.dataset.theme === currentTheme) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        // --- [NEW] Settings Panel UI Generation ---
        function setupSettingsUI() {
            // --- 1. Background Settings ---
            const bgSettingsContainer = document.getElementById('background-settings-content');
            if (bgSettingsContainer) {
                const bgOptions = [
                    { value: 'default', label: 'é»˜è®¤å›¾ç‰‡' },
                    { value: 'bing', label: 'æ¯æ—¥ä¸€Bing' },
                    { value: 'anime', label: 'éšæœºåŠ¨æ¼«' },
                    { value: 'random', label: 'éšæœºå›¾ç‰‡' }
                ];

                let bgSettingsHTML = '';
                bgOptions.forEach(option => {
                    bgSettingsHTML += `
                        <div>
                            <input type="radio" id="bg-radio-${option.value}" name="background-source" value="${option.value}" class="setting-radio-input">
                            <label for="bg-radio-${option.value}" class="setting-radio-label">
                                <span class="custom-radio-button"></span>
                                <span>${option.label}</span>
                            </label>
                        </div>
                    `;
                });
                
                let defaultOptionsHTML = `
                    <div id="default-bg-options">
                        <div class="thumb-container">
                            <div class="thumb-item" data-bg-url="random">
                                <div class="thumb-overlay">éšæœº</div>
                            </div>
                `;
                DEFAULT_BG_IMAGES.forEach((url, index) => {
                    defaultOptionsHTML += `
                        <div class="thumb-item" data-bg-url="${url}">
                            <img src="${url}" alt="Default Background ${index + 1}" loading="lazy">
                        </div>
                    `;
                });
                defaultOptionsHTML += `</div></div>`;

                bgSettingsContainer.innerHTML = bgSettingsHTML + defaultOptionsHTML;
            }

            // --- 2. Theme Mode Settings ---
            const themeSettingsContainer = document.getElementById('theme-settings-content').parentElement;
            if (themeSettingsContainer) {
                themeSettingsContainer.querySelector('h3').textContent = 'ä¸»é¢˜æ¨¡å¼';
                const container = themeSettingsContainer.querySelector('#theme-settings-content');
                container.innerHTML = `
                    <div class="setting-btn-group w-full">
                        <button class="setting-btn" data-theme="system">è·Ÿéšç³»ç»Ÿ</button>
                        <button class="setting-btn" data-theme="light">æ—¥é—´æ¨¡å¼</button>
                        <button class="setting-btn" data-theme="dark">å¤œé—´æ¨¡å¼</button>
                    </div>
                `;
            }

            // --- 3. View Toggle Settings ---
            const viewToggleContainer = document.getElementById('view-toggle-content');
            if (viewToggleContainer) {
                viewToggleContainer.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex flex-col">
                            <span class="font-medium">æ˜¯å¦åˆ‡æ¢GitHubè´¡çŒ®å›¾ä¸ºå¤©æ°”ä¿¡æ¯</span>
                            <span id="view-toggle-label" class="text-sm mt-1" style="color: var(--text-color-secondary);">å½“å‰æ˜¾ç¤º: GitHub è´¡çŒ®å›¾</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="view-toggle-checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div id="manual-city-input-wrapper" class="mt-2 pl-1" style="max-height: 0; overflow: hidden; transition: all 0.3s ease;">
                         <input type="text" id="weather-city-input" placeholder="æ‰‹åŠ¨è¾“å…¥åŸå¸‚ (å›è½¦ç¡®è®¤)" class="w-full rounded-md border px-3 py-1.5 text-sm" style="background-color: var(--progress-bar-bg); border-color: var(--separator-color); color: var(--text-color-primary);">
                    </div>
                `;
            }
        }

        function updateViewToggleUI() {
            const toggle = document.getElementById('view-toggle-checkbox');
            const label = document.getElementById('view-toggle-label');
            const cityInputWrapper = document.getElementById('manual-city-input-wrapper');
            const cityInput = document.getElementById('weather-city-input');

            const isWeatherView = appSettings.view === 'weather';
            toggle.checked = isWeatherView;
            label.textContent = isWeatherView ? 'å½“å‰æ˜¾ç¤º: å¤©æ°”ä¿¡æ¯' : 'å½“å‰æ˜¾ç¤º: GitHub è´¡çŒ®å›¾';
            
            cityInputWrapper.style.maxHeight = isWeatherView ? '50px' : '0';
            cityInputWrapper.style.marginTop = isWeatherView ? '0.5rem' : '0';

            if (isWeatherView) {
                cityInput.placeholder = appSettings.weather.city || appSettings.weather.lastFetchedCity || 'æ‰‹åŠ¨è¾“å…¥åŸå¸‚';
            }
        }

        function updateSettingsUI() {
            updateBgSettingsUI();
            updateThemeSettingsUI();
            updateViewToggleUI();
        }

        // --- [NEW] View (GitHub/Weather) Management ---
        function applyCurrentView() {
            const githubView = document.getElementById('github-view');
            const weatherView = document.getElementById('weather-view');
            
            if (appSettings.view === 'weather') {
                githubView.classList.add('hidden');
                weatherView.classList.remove('hidden');
                fetchAndDisplayWeather();
            } else {
                weatherView.classList.add('hidden');
                githubView.classList.remove('hidden');
            }
        }

        function applyCurrentTheme() {
            const body = document.body;
            // Clear all theme-* classes before adding the new one
            body.classList.forEach(className => {
                if (className.startsWith('theme-')) {
                    body.classList.remove(className);
                }
            });

            let themeToApply;
            if (appSettings.theme === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                themeToApply = prefersDark ? 'theme-dark' : 'theme-light';
            } else {
                themeToApply = `theme-${appSettings.theme}`;
            }
            body.classList.add(themeToApply);
        }

        // --- äº¤äº’äº‹ä»¶ç›‘å¬ ---
        function setupEventListeners() {
            // --- Theme Settings Listeners ---
            document.querySelectorAll('.setting-btn-group .setting-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    appSettings.theme = theme;
                    applyCurrentTheme();
                    saveSettings();
                    updateThemeSettingsUI(); // Update active state
                });
            });

            // --- Background Settings Listeners ---
            const bgRadioButtons = document.querySelectorAll('input[name="background-source"]');
            const defaultOptionsContainer = document.getElementById('default-bg-options');

            bgRadioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    const source = radio.value;
                    appSettings.background.source = source;

                    if (source === 'default') {
                        defaultOptionsContainer.classList.add('open');
                        // When switching to default, immediately apply the currently selected default image
                        applyCurrentBackground();
                    } else {
                        defaultOptionsContainer.classList.remove('open');
                        applyCurrentBackground();
                    }
                    saveSettings();
                });
            });

            const thumbItems = defaultOptionsContainer.querySelectorAll('.thumb-item');
            thumbItems.forEach(thumb => {
                thumb.addEventListener('click', () => {
                    // This listener only matters when the 'default' source is active
                    if (appSettings.background.source !== 'default') {
                        // To be safe, check the 'default' radio
                        document.getElementById('bg-radio-default').checked = true;
                        appSettings.background.source = 'default';
                    }
                    
                    const specifier = thumb.dataset.bgUrl;
                    appSettings.background.specifier = specifier;
                    
                    // Update UI immediately for responsiveness
                    thumbItems.forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                    
                    applyCurrentBackground();
                    saveSettings();
                });
            });


            // --- View Toggle Listeners ---
            const viewToggle = document.getElementById('view-toggle-checkbox');
            const cityInput = document.getElementById('weather-city-input');

            viewToggle.addEventListener('change', () => {
                appSettings.view = viewToggle.checked ? 'weather' : 'github';
                applyCurrentView();
                updateViewToggleUI();
                saveSettings();
            });

            cityInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const newCity = e.target.value.trim();
                    if (newCity) {
                        appSettings.weather.city = newCity;
                        fetchAndDisplayWeather(); // Re-fetch with new city
                        e.target.blur();
                        e.target.value = ''; // Clear input after submission
                    }
                }
            });


            // --- Settings Modal Logic ---
            const openSettingsBtn = document.getElementById('open-settings-btn');
            const settingsOverlay = document.getElementById('settings-overlay');
            const closeSettingsBtn = document.getElementById('close-settings-btn');

            function openSettings() {
                const settingsWindow = document.getElementById('settings-window');
                
                // Use the cached height on larger screens
                if (window.innerWidth >= 1024 && cachedRightColumnHeight > 0) {
                    settingsWindow.style.height = `${cachedRightColumnHeight}px`;
                } else {
                    // On smaller screens, reset to auto height to remain responsive
                    settingsWindow.style.height = 'auto';
                }

                document.body.classList.add('settings-open');

                // Initialize SimpleBar on the content area if it hasn't been already
                if (!settingsSimpleBar) {
                    const contentWrapper = settingsWindow.querySelector('[data-simplebar]');
                    if (contentWrapper) {
                        settingsSimpleBar = new SimpleBar(contentWrapper);
                    }
                }
            }

            function closeSettings() {
                document.body.classList.remove('settings-open');
            }

            openSettingsBtn.addEventListener('click', openSettings);
            closeSettingsBtn.addEventListener('click', closeSettings);

            settingsOverlay.addEventListener('click', (e) => {
                if (e.target === settingsOverlay) {
                    closeSettings();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && document.body.classList.contains('settings-open')) {
                    closeSettings();
                }
            });
            // --- End Settings Modal Logic ---

            const animateRightColumnIn = () => {
                const elementsToAnimate = rightColumn.querySelectorAll(':scope > div');
                elementsToAnimate.forEach(el => {
                    el.classList.remove('bounce-in');
                    void el.offsetWidth;
                    el.classList.add('bounce-in');
                });
            };

            // åˆ‡æ¢åˆ°æ—¶å…‰èƒ¶å›Š
            profileCard.addEventListener('click', (e) => { // 1. æ¥æ”¶ event å¯¹è±¡ï¼Œå‘½åä¸º e
                // 2. å¢åŠ åˆ¤æ–­ï¼šå¦‚æœç‚¹å‡»çš„ç›®æ ‡æ˜¯ <a> æ ‡ç­¾æˆ–å…¶å†…éƒ¨å…ƒç´ ï¼Œåˆ™ç›´æ¥è¿”å›
                if (e.target.closest('a')) {
                    return;
                }

                // If the time capsule is already visible, hide it and show the main column.
                if (!timeCapsuleCard.classList.contains('hidden')) {
                    timeCapsuleCard.classList.add('hidden');
                    rightColumn.classList.remove('hidden');
                    animateRightColumnIn();
                } else { // Otherwise, show it.
                    rightColumn.classList.add('hidden');
                    holidayListCard.classList.add('hidden');
                    timeCapsuleCard.classList.remove('hidden');
                    timeCapsuleCard.classList.add('bounce-in');
                    updateTimeCapsule();
                }
            });

            // å…³é—­æ—¶å…‰èƒ¶å›Š
            document.getElementById('close-time-capsule').addEventListener('click', (e) => {
                e.stopPropagation();
                timeCapsuleCard.classList.add('hidden');
                rightColumn.classList.remove('hidden');
                animateRightColumnIn();
            });

            // åˆ‡æ¢åˆ°èŠ‚æ—¥åˆ—è¡¨
            countdownCard.addEventListener('click', () => {
                if (!holidayListCard.classList.contains('hidden')) {
                    holidayListCard.classList.add('hidden');
                    rightColumn.classList.remove('hidden');
                    animateRightColumnIn();
                } else {
                    hasManuallyScrolled = false; // Reset scroll flag
                    rightColumn.classList.add('hidden');
                    timeCapsuleCard.classList.add('hidden');
                    holidayListCard.classList.remove('hidden');
                    holidayListCard.classList.add('bounce-in');
                    holidayListDisplayedYear = new Date().getFullYear();
                    displayHolidayList(holidayListDisplayedYear, true);
                    updateWarningMessage(holidayListDisplayedYear);
                    
                    // Only initialize SimpleBar and listeners once to prevent bugs
                    if (!holidayListSimpleBar) {
                        holidayListSimpleBar = new SimpleBar(document.getElementById('holiday-list-container-wrapper'));
                        const scrollElement = holidayListSimpleBar.getScrollElement();
                        const maskContainer = document.getElementById('holiday-list-container-wrapper');
                        const maxFadeSize = 40;

                        const updateMask = () => {
                            const { scrollTop, scrollHeight, clientHeight } = scrollElement;
                            const tolerance = 1;
                            if (scrollHeight <= clientHeight + tolerance) {
                                maskContainer.style.setProperty('--fade-top-size', '0px');
                                maskContainer.style.setProperty('--fade-bottom-size', '0px');
                                return;
                            }
                            const scrollBottom = scrollHeight - clientHeight - scrollTop;
                            const topFade = Math.min(scrollTop, maxFadeSize);
                            const bottomFade = Math.min(scrollBottom, maxFadeSize);
                            maskContainer.style.setProperty('--fade-top-size', `${topFade}px`);
                            maskContainer.style.setProperty('--fade-bottom-size', `${bottomFade}px`);
                        };

                        scrollElement.addEventListener('scroll', updateMask);
                        
                        // Also handle the original manual scroll flag listener
                        scrollElement.addEventListener('scroll', () => {
                            hasManuallyScrolled = true;
                        }, { once: true });

                        // Call once after a short delay to ensure layout is calculated correctly
                        setTimeout(updateMask, 50);
                    }

                    // Initial scroll is now animated
                    setTimeout(() => {
                        scrollToTargetFestival(true);
                    }, 50);
                }
            });

            // å…³é—­èŠ‚æ—¥åˆ—è¡¨
            document.getElementById('close-holiday-list').addEventListener('click', (e) => {
                e.stopPropagation();
                holidayListCard.classList.add('hidden');
                rightColumn.classList.remove('hidden');
                animateRightColumnIn();
            });

            // "å›åˆ°ä»Šå¤©"æŒ‰é’®é€»è¾‘
            document.getElementById('back-to-today-btn').addEventListener('click', () => {
                const currentYear = new Date().getFullYear();
                if (holidayListDisplayedYear !== currentYear) {
                    handleYearChange(currentYear);
                }
                scrollToTargetFestival(true);
            });

            // [NEW] Warning message logic
            const updateWarningMessage = (year) => {
                const yearWarning = document.getElementById('year-range-warning');
                if (year < 1900 || year > 2049) {
                    yearWarning.innerHTML = `<svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><span>${year}å¹´çš„å†œå†èŠ‚æ—¥å¯èƒ½ä¸å‡†ç¡®</span>`;
                    if (yearWarning.classList.contains('hidden')) {
                        yearWarning.classList.remove('hidden', 'animate-fade-out');
                        yearWarning.classList.add('animate-fade-in');
                        setTimeout(() => yearWarning.classList.remove('animate-fade-in'), 100);
                    }
                } else {
                    if (!yearWarning.classList.contains('hidden')) {
                        yearWarning.classList.add('animate-fade-out');
                        setTimeout(() => {
                            yearWarning.classList.add('hidden');
                            yearWarning.classList.remove('animate-fade-out');
                        }, 100);
                    }
                }
            };

            // èŠ‚æ—¥åˆ—è¡¨å¹´ä»½åˆ‡æ¢
            const handleYearChange = (newYear) => {
                const yearBeforeChange = holidayListDisplayedYear;
                const currentSystemYear = new Date().getFullYear();
                
                holidayListDisplayedYear = newYear;
                displayHolidayList(holidayListDisplayedYear, true);
                updateWarningMessage(newYear); // Centralized call to handle warning

                // Check for smart scroll condition
                if (hasManuallyScrolled && holidayListDisplayedYear === currentSystemYear && yearBeforeChange !== currentSystemYear) {
                    scrollToTargetFestival(true);
                    hasManuallyScrolled = false; // Reset flag after use
                }
            };

            document.getElementById('prev-year').addEventListener('click', () => {
                handleYearChange(holidayListDisplayedYear - 1);
            });
            document.getElementById('next-year').addEventListener('click', () => {
                handleYearChange(holidayListDisplayedYear + 1);
            });

            // --- [NEW] Year Input Logic ---
            const enterEditMode = () => {
                yearDisplayControls.classList.add('animate-fade-out');
                setTimeout(() => {
                    yearDisplayControls.classList.add('hidden');
                    yearDisplayControls.classList.remove('animate-fade-out');

                    yearEditControls.classList.remove('hidden');
                    yearEditControls.classList.add('animate-fade-in');
                    yearInput.value = holidayListDisplayedYear;
                    yearInput.focus();
                    yearInput.select();

                    setTimeout(() => {
                        yearEditControls.classList.remove('animate-fade-in');
                    }, 100);
                }, 100);
            };

            const exitEditMode = () => {
                yearInput.classList.remove('invalid');
                yearInputError.classList.add('hidden');

                yearEditControls.classList.add('animate-fade-out');
                setTimeout(() => {
                    yearEditControls.classList.add('hidden');
                    yearEditControls.classList.remove('animate-fade-out');

                    yearDisplayControls.classList.remove('hidden');
                    yearDisplayControls.classList.add('animate-fade-in');
                    setTimeout(() => {
                        yearDisplayControls.classList.remove('animate-fade-in');
                    }, 100);
                }, 100);
            };

            const submitNewYear = () => {
                const newYear = parseInt(yearInput.value, 10);
                // Relaxed validation as per user request.
                if (!isNaN(newYear) && newYear > 0 && newYear < 9999) {
                    handleYearChange(newYear);
                    exitEditMode();
                } else {
                    yearInputError.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„4ä½å¹´ä»½';
                    yearInputError.classList.remove('hidden');
                    yearInput.classList.add('invalid');
                    setTimeout(() => {
                        yearInput.classList.remove('invalid');
                    }, 500);
                    setTimeout(() => {
                         yearInputError.classList.add('hidden');
                    }, 2500);
                }
            };

            holidayListYearSpan.addEventListener('click', enterEditMode);
            confirmYearBtn.addEventListener('click', submitNewYear);
            cancelYearBtn.addEventListener('click', exitEditMode);
            yearInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { submitNewYear(); }
                else if (e.key === 'Escape') { exitEditMode(); }
            });

            // ç‚¹å‡»ä¸€è¨€å¡ç‰‡åˆ·æ–°
            document.getElementById('hitokoto-card').addEventListener('click', fetchHitokoto);
        }

        // --- é¡µé¢åŠ è½½æ—¶æ‰§è¡Œçš„å‡½æ•° ---
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            applyCurrentTheme();
            applyCurrentBackground();
            applyCurrentView(); // This will fetch weather if needed

            updateTime();
            updateGreeting();
            updateCountdown();
            fetchHitokoto();
            setupGitHubChartLoader();
            
            // ç¡®ä¿å¸ƒå±€ç¨³å®šåå†è·å–é«˜åº¦ï¼Œå¹¶åŒæ­¥å¡ç‰‡é«˜åº¦
            setTimeout(() => {
                // ä»…åœ¨æ¡Œé¢è§†å›¾ï¼ˆlgæ–­ç‚¹ä»¥ä¸Šï¼‰åº”ç”¨å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢å½±å“ç§»åŠ¨ç«¯å¸ƒå±€
                if (window.innerWidth >= 1024) {
                    const rightColumnHeight = rightColumn.offsetHeight;
                    cachedRightColumnHeight = rightColumnHeight; // Cache the stable height
                }
                setupSettingsUI();
                setupEventListeners();
                updateSettingsUI(); // Update UI to reflect loaded settings
            }, 100);

            updateSiteRuntime();
            updateTimeCapsule();
            
            setInterval(updateTime, 1000);
            setInterval(updateSiteRuntime, 1000);
            setInterval(updateGreeting, 1800000); 
            setInterval(updateCountdown, 3600000); 
            setInterval(updateTimeCapsule, 60000);

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (appSettings.theme === 'system') {
                    applyCurrentTheme();
                }
            });
        });
    </script>
</body>
</html>
